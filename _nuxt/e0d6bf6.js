(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{408:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));n(21),n(15),n(18),n(32),n(33);var r=n(4),c=n(7),o=n(30),l=n(31),d=(n(303),n(16),n(25),n(3)),_=n(1),f=n.n(_),m=n(6),h=n(5);function j(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function y(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(t){Object(c.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,e),this.json=y(y({},t),{},{price_per_unit:t.price_per_unit?Object(h.m)(t.price_per_unit):""})}var t,n,c,_,j,O,w,v,k,x,$;return Object(l.a)(e,[{key:"save",value:($=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,c=Object(h.e)(this.json,"otherBilling"),!this.json.id){e.next=8;break}return e.next=5,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/")),{data:c,headers:Object(m.c)(!0)});case 5:r=e.sent,e.next=11;break;case 8:return e.next=10,Object(m.d)("post",Object(m.e)(m.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/")),{data:c,headers:Object(m.c)(!0)});case 10:r=e.sent;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return $.apply(this,arguments)})},{key:"generateWaterBill",value:(x=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=null,(o=Object(d.cloneDeep)(this.json)).billing_cycle=this.json.billing_cycle?f()(this.json.billing_cycle).unix():null,o.due_datetime=this.json.due_datetime?f()(this.json.due_datetime).unix():null,o.price_per_unit=this.json.price_per_unit?Number(this.json.price_per_unit):null,o.from_datetime=this.json.from_datetime?f()(this.json.from_datetime).unix():null,o.to_datetime=this.json.to_datetime?f()(this.json.to_datetime).unix():null,o=Object(d.pickBy)(o,d.isNil),e.next=10,Object(m.d)("post",Object(m.e)(m.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/generate_asset_billings")),{data:y({billing:o},r),headers:Object(m.c)(!0)});case 10:return c=e.sent,e.abrupt("return",c);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return x.apply(this,arguments)})},{key:"update",value:(k=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(h.e)(this.json,"billing"),e.next=3,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/").concat(this.json.id)),{data:{billing:r},headers:Object(m.c)(!0)});case 3:return c=e.sent,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"asTableJson",value:function(){return{asset:this.json.asset,asset_id:this.json.asset_id,address_number:this.json.asset?this.json.asset.address_number:"",asset_number:this.json.asset?this.json.asset.asset_number:"",building:this.json.asset?this.json.asset.building:"",floor:this.json.asset?this.json.asset.floor:"",usable_area:this.json.asset?Object(h.m)(this.json.asset.usable_area):"",area_for_maintenance_fee_calculation:this.json.asset?Object(h.m)(this.json.asset.area_for_maintenance_fee_calculation):"",asset_type:this.json.asset&&this.json.asset.asset_type?this.json.asset.asset_type.name:"",asset_model:this.json.asset&&this.json.asset.asset_model?this.json.asset.asset_model:"-",billing_cycle_month:this.json.billing_cycle?this.json.billing_cycle.month:"",actual_unit_price:this.json.asset?Object(h.c)(Object(h.m)(this.json.asset.area_for_maintenance_fee_calculation)*Object(h.m)(this.json.price_per_unit)):"",area:this.json.asset?Object(h.m)(this.json.asset.area):"",amount:this.json.amount?Object(h.c)(this.json.amount):"-",name:this.json.name,no:this.json.no,billing_cycle:this.json.billing_cycle?this.json.billing_cycle.name:null,billing_type_id:this.json.billing_type_id,created_at:this.json.created_at,from_datetime:Object(h.g)(this.json.from_datetime),from_datetime_invoice:Object(h.g)(this.json.from_datetime,"YYYY/MM/DD"),id:this.json.id,price_per_unit:this.json.price_per_unit?Object(h.c)(this.json.price_per_unit):"-",status:this.json.status,to_datetime:Object(h.g)(this.json.to_datetime),to_datetime_invoice:Object(h.g)(this.json.to_datetime,"YYYY/MM/DD"),total_price:Object(h.c)(this.json.total_price)||"-",unit:this.json.unit,payment_type:this.json.billing_cycle?this.json.billing_cycle.extra_detail_json.payment_calculation_by:"",previous_meter:Object(d.isNil)(this.json.previous_meter)?"-":this.json.previous_meter,current_meter:Object(d.isNil)(this.json.current_meter)?"-":this.json.current_meter,billing_type:this.json.billing_type,billing_owner:this.json.have_owner}}}],[{key:"typesIndex",value:(v=Object(r.a)(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.d)("get",Object(m.e)(m.a,"projects/".concat(n,"/billing_types")),{headers:Object(m.c)(!0)});case 2:if(200!==(r=t.sent).status){t.next=5;break}return t.abrupt("return",Object(d.map)(r.data.billing_types,(function(t){return new e(t)})));case 5:return t.abrupt("return",[]);case 6:case"end":return t.stop()}}),t)}))),function(e){return v.apply(this,arguments)})},{key:"index",value:(w=Object(r.a)(regeneratorRuntime.mark((function t(n,r,c){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.d)("get",Object(m.e)(m.a,"projects/".concat(n,"/billing_types/").concat(r,"/billings/")),{params:{billing_cycle_name:c},headers:Object(m.c)(!0)});case 2:if(200!==(o=t.sent).status){t.next=5;break}return t.abrupt("return",Object(d.map)(o.data.billings,(function(t,n){return t.no=n+1,new e(t)})));case 5:return t.abrupt("return",[]);case 6:case"end":return t.stop()}}),t)}))),function(e,t,n){return w.apply(this,arguments)})},{key:"billingsByStatus",value:(O=Object(r.a)(regeneratorRuntime.mark((function t(n,r,c,o,l,_,f,h){var j,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.d)("get",Object(m.e)(m.a,"projects/".concat(n,"/billing_types/").concat(r,"/billings/billings_by_status")),{params:{billing_cycle_name:c,status:o,query_date:l,page:_,per_page:f,search:h},headers:Object(m.c)(!0)});case 2:if(200!==(j=t.sent).status){t.next=6;break}return y=Object(d.map)(j.data.billings,(function(t){return new e(t)})),t.abrupt("return",{billings:y,total_count:j.data.total_count});case 6:return t.abrupt("return",[]);case 7:case"end":return t.stop()}}),t)}))),function(e,t,n,r,c,o,l,d){return O.apply(this,arguments)})},{key:"billingsCountByStatus",value:(j=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r,c){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("get",Object(m.e)(m.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/billings_count_by_status")),{params:{billing_cycle_name:r,query_date:c},headers:Object(m.c)(!0)});case 2:if(200!==(o=e.sent).status){e.next=5;break}return e.abrupt("return",o.data.billings);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return j.apply(this,arguments)})},{key:"updateBillings",value:(_=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/update_billings")),{data:{billings:r},headers:Object(m.c)(!0)});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return _.apply(this,arguments)})},{key:"cancel",value:(c=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/").concat(r,"/cancel")),{headers:Object(m.c)(!0)});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"finalize",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/").concat(r,"/finalize")),{headers:Object(m.c)(!0)});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"finalizeBillings",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/finalize_billings")),{params:{billing_ids:r},headers:Object(m.c)(!0)});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}()},435:function(e,t,n){var content=n(465);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(23).default)("0b804393",content,!0,{sourceMap:!1})},464:function(e,t,n){"use strict";n(435)},465:function(e,t,n){var r=n(22)(!1);r.push([e.i,"img[data-v-69abbc12]{width:18px;height:18px}",""]),e.exports=r},556:function(e,t,n){"use strict";n.r(t);var r=n(4),c=(n(25),n(11),n(3)),o=n(5),l=n(408),d={filters:{paymentType:function(data){if(data){return Object(c.find)([{label:"Pay as Actual",value:"actual"},{label:"Pay as Unit Type",value:"asset_type"}],["value",data]).label}}},props:{items:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!0},currentTab:{type:String,default:""}},data:function(){return{editImage:"",columns:[]}},watch:{currentTab:function(e){"modified"===e&&this.renderColumns()}},mounted:function(){this.renderColumns()},methods:{renderColumns:function(){var e=this,t={select:{type:"selection",width:60,align:"center"},number:{key:"no",width:120,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.no")))}},billingCycle:{key:"billing_cycle",width:120,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.billing_cycle")))}},assetNumber:{key:"asset_number",width:100,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.room_no")))}},modelType:{key:"asset_type",width:150,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.model_type")))}},houseNumber:{key:"address_number",width:160,sortable:"custom",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.house_number")))}},assetType:{key:"asset_type",width:150,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.unit_type")))}},area:{key:"area",width:150,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.area")))}},usableArea:{key:"usable_area",width:150,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.usable_area")))}},billingOwner:{slot:"billing_owner",width:150,align:"center",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.billing_owner")))}},floor:{key:"floor",width:150,align:"center",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.floor")))}},paymentType:{title:this.$t("info.maintenance.label.payment_type"),slot:"payment_type",width:150,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.payment_type")))}},areaForMaintenanceFeeCalculation:{key:"area_for_maintenance_fee_calculation",align:"right",width:180,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.area_for_maintenance_fee_calculation")))}},pricePerUnitForCondominium:{key:"price_per_unit",align:"right",width:160,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.price_per_sqm")))}},pricePerUnitForHome:{key:"price_per_unit",align:"right",width:160,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.price_per_sqw")))}},month:{key:"billing_cycle_month",align:"right",width:160,renderHeader:function(t,n){return t("span","".concat(e.$t("info.bill_cycle.label.month")))}},totalPrice:{key:"total_price",slot:"total_price",align:"right",width:160,sortable:"custom",renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.amount")))}},status:{key:"status",slot:"status",align:"center",width:160,sortable:"custom",renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.status")))}},action:{slot:"action",align:"center",width:240,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.action")))}}},n=[t.number,t.billingCycle,t.assetNumber,t.houseNumber,t.assetType,t.billingOwner,t.floor,t.paymentType,t.areaForMaintenanceFeeCalculation,t.pricePerUnitForCondominium,t.month,t.totalPrice,t.status,t.action],r=[];switch(this.$store.getters.project.project_type){case"condominium":r=n;break;case"home_office":case"single_house":case"townhouse":r=[t.number,t.houseNumber,t.modelType,t.billingOwner,t.area,t.usableArea,t.paymentType,t.areaForMaintenanceFeeCalculation,t.pricePerUnitForHome,t.month,t.totalPrice,t.status,t.action];break;default:r=n}if("modified"===this.currentTab)r.splice(0,0,t.select);else if("paid"===this.currentTab){r.pop();var o=Object(c.findIndex)(r,{slot:"billing_owner"});o>-1&&r.splice(o,1)}else if("waiting_payment"===this.currentTab){var l=Object(c.findIndex)(r,{slot:"action"});l>-1&&r.splice(l,1);var d=Object(c.findIndex)(r,{slot:"billing_owner"});d>-1&&r.splice(d,1)}else if("cancelled"===this.currentTab){var _=Object(c.findIndex)(r,{slot:"billing_owner"});_>-1&&r.splice(_,1)}this.columns=r},handleSortChange:function(e){this.$emit("sortBy",e.key,e.order)},handleBeforeChange:function(e,t,n){var r=this;return new Promise((function(l){r.$Modal.confirm({title:r.$t("pages.confirm"),content:r.$t("messages.confirm_".concat(e)),okText:r.$t("button.yes"),cancelText:r.$t("button.no"),onOk:function(){"finalize"===e&&Object(c.isNaN)(Object(o.b)(n.price_per_unit))?r.$Message.error({content:r.$t("messages.fill_data"),duration:6}):r.changeStatus(e,t)}})}))},convertIsBillingOwner:function(e){return e?this.$t("info.user.billing_owner.label.is_billing_owner"):this.$t("info.user.billing_owner.label.is_not_billing_owner")},changeStatus:function(e,t,n){var c=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a[e](c.$route.params.projectId,c.$route.params.billingId,t);case 2:200===(r=n.sent).status?(c.$Message.success({content:c.$t("messages.bill_status_".concat(r.data.billing.status)),duration:3}),c.$emit("reloadData")):r.data&&r.data.error?c.$Message.error({content:r.data.error,duration:8}):c.$Message.error({content:c.$t("messages.fail"),duration:8});case 4:case"end":return n.stop()}}),n)})))()}}},_=(n(464),n(9)),component=Object(_.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Table",{attrs:{columns:e.columns,data:e.items,loading:e.loading,"no-data-text":e.$t("pages.no_data")},on:{"on-selection-change":function(t){return e.$emit("rowSelections",t)},"on-sort-change":e.handleSortChange},scopedSlots:e._u([{key:"payment_type",fn:function(t){var n=t.row;return[e._v("\n      "+e._s("actual"===n.payment_type?e.$t("info.bill_cycle.payment_type.actual"):e.$t("info.bill_cycle.payment_type.asset_type"))+"\n    ")]}},{key:"total_price",fn:function(t){var r=t.row;return["actual"===r.payment_type?n("span",[e._v("\n        "+e._s(r.total_price)+"\n      ")]):n("span",[e._v("\n        "+e._s(r.price_per_unit)+"\n      ")])]}},{key:"status",fn:function(e){var t=e.row;return[n("GStatusLabelPreview",{attrs:{status:t.status}})]}},{key:"billing_owner",fn:function(t){var n=t.row;return[e._v("\n      "+e._s(e.convertIsBillingOwner(n.billing_owner)||"-")+"\n    ")]}},{key:"action",fn:function(t){var r=t.row;return[["draft","ready","modified","waiting_payment"].includes(r.status)?n("Tooltip",{attrs:{content:e.$t("button.edit"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{size:"20",type:"ios-create-outline"},on:{click:function(t){return e.$emit("extraFunctionWithObject",r)}}})],1):e._e(),e._v(" "),["modified"].includes(r.status)?n("Tooltip",{attrs:{content:e.$t("button.finalize"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-checkmark-circle-outline",size:"20"},on:{click:function(t){return e.handleBeforeChange("finalize",r.id,r)}}})],1):e._e(),e._v(" "),["draft","modified","ready"].includes(r.status)?n("Tooltip",{attrs:{content:e.$t("button.cancel"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-close-circle-outline",size:"20"},on:{click:function(t){return e.handleBeforeChange("cancel",r.id)}}})],1):e._e()]}}])})],1)}),[],!1,null,"69abbc12",null);t.default=component.exports}}]);