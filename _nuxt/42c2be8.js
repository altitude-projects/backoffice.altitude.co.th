(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{408:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));n(21),n(15),n(18),n(32),n(33);var r=n(4),c=n(7),o=n(30),l=n(31),d=(n(303),n(16),n(25),n(3)),f=n(1),_=n.n(f),h=n(6),m=n(5);function j(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function y(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(t){Object(c.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,e),this.json=y(y({},t),{},{price_per_unit:t.price_per_unit?Object(m.m)(t.price_per_unit):""})}var t,n,c,f,j,O,w,v,k,x,$;return Object(l.a)(e,[{key:"save",value:($=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,c=Object(m.e)(this.json,"otherBilling"),!this.json.id){e.next=8;break}return e.next=5,Object(h.d)("patch",Object(h.e)(h.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/")),{data:c,headers:Object(h.c)(!0)});case 5:r=e.sent,e.next=11;break;case 8:return e.next=10,Object(h.d)("post",Object(h.e)(h.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/")),{data:c,headers:Object(h.c)(!0)});case 10:r=e.sent;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return $.apply(this,arguments)})},{key:"generateWaterBill",value:(x=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=null,(o=Object(d.cloneDeep)(this.json)).billing_cycle=this.json.billing_cycle?_()(this.json.billing_cycle).unix():null,o.due_datetime=this.json.due_datetime?_()(this.json.due_datetime).unix():null,o.price_per_unit=this.json.price_per_unit?Number(this.json.price_per_unit):null,o.from_datetime=this.json.from_datetime?_()(this.json.from_datetime).unix():null,o.to_datetime=this.json.to_datetime?_()(this.json.to_datetime).unix():null,o=Object(d.pickBy)(o,d.isNil),e.next=10,Object(h.d)("post",Object(h.e)(h.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/generate_asset_billings")),{data:y({billing:o},r),headers:Object(h.c)(!0)});case 10:return c=e.sent,e.abrupt("return",c);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return x.apply(this,arguments)})},{key:"update",value:(k=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(m.e)(this.json,"billing"),e.next=3,Object(h.d)("patch",Object(h.e)(h.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/").concat(this.json.id)),{data:{billing:r},headers:Object(h.c)(!0)});case 3:return c=e.sent,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"asTableJson",value:function(){return{asset:this.json.asset,asset_id:this.json.asset_id,address_number:this.json.asset?this.json.asset.address_number:"",asset_number:this.json.asset?this.json.asset.asset_number:"",building:this.json.asset?this.json.asset.building:"",floor:this.json.asset?this.json.asset.floor:"",usable_area:this.json.asset?Object(m.m)(this.json.asset.usable_area):"",area_for_maintenance_fee_calculation:this.json.asset?Object(m.m)(this.json.asset.area_for_maintenance_fee_calculation):"",asset_type:this.json.asset&&this.json.asset.asset_type?this.json.asset.asset_type.name:"",asset_model:this.json.asset&&this.json.asset.asset_model?this.json.asset.asset_model:"-",billing_cycle_month:this.json.billing_cycle?this.json.billing_cycle.month:"",actual_unit_price:this.json.asset?Object(m.c)(Object(m.m)(this.json.asset.area_for_maintenance_fee_calculation)*Object(m.m)(this.json.price_per_unit)):"",area:this.json.asset?Object(m.m)(this.json.asset.area):"",amount:this.json.amount?Object(m.c)(this.json.amount):"-",name:this.json.name,no:this.json.no,billing_cycle:this.json.billing_cycle?this.json.billing_cycle.name:null,billing_type_id:this.json.billing_type_id,created_at:this.json.created_at,from_datetime:Object(m.g)(this.json.from_datetime),from_datetime_invoice:Object(m.g)(this.json.from_datetime,"YYYY/MM/DD"),id:this.json.id,price_per_unit:this.json.price_per_unit?Object(m.c)(this.json.price_per_unit):"-",status:this.json.status,to_datetime:Object(m.g)(this.json.to_datetime),to_datetime_invoice:Object(m.g)(this.json.to_datetime,"YYYY/MM/DD"),total_price:Object(m.c)(this.json.total_price)||"-",unit:this.json.unit,payment_type:this.json.billing_cycle?this.json.billing_cycle.extra_detail_json.payment_calculation_by:"",previous_meter:Object(d.isNil)(this.json.previous_meter)?"-":this.json.previous_meter,current_meter:Object(d.isNil)(this.json.current_meter)?"-":this.json.current_meter,billing_type:this.json.billing_type,billing_owner:this.json.have_owner}}}],[{key:"typesIndex",value:(v=Object(r.a)(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(h.d)("get",Object(h.e)(h.a,"projects/".concat(n,"/billing_types")),{headers:Object(h.c)(!0)});case 2:if(200!==(r=t.sent).status){t.next=5;break}return t.abrupt("return",Object(d.map)(r.data.billing_types,(function(t){return new e(t)})));case 5:return t.abrupt("return",[]);case 6:case"end":return t.stop()}}),t)}))),function(e){return v.apply(this,arguments)})},{key:"index",value:(w=Object(r.a)(regeneratorRuntime.mark((function t(n,r,c){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(h.d)("get",Object(h.e)(h.a,"projects/".concat(n,"/billing_types/").concat(r,"/billings/")),{params:{billing_cycle_name:c},headers:Object(h.c)(!0)});case 2:if(200!==(o=t.sent).status){t.next=5;break}return t.abrupt("return",Object(d.map)(o.data.billings,(function(t,n){return t.no=n+1,new e(t)})));case 5:return t.abrupt("return",[]);case 6:case"end":return t.stop()}}),t)}))),function(e,t,n){return w.apply(this,arguments)})},{key:"billingsByStatus",value:(O=Object(r.a)(regeneratorRuntime.mark((function t(n,r,c,o,l,f,_,m){var j,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(h.d)("get",Object(h.e)(h.a,"projects/".concat(n,"/billing_types/").concat(r,"/billings/billings_by_status")),{params:{billing_cycle_name:c,status:o,query_date:l,page:f,per_page:_,search:m},headers:Object(h.c)(!0)});case 2:if(200!==(j=t.sent).status){t.next=6;break}return y=Object(d.map)(j.data.billings,(function(t){return new e(t)})),t.abrupt("return",{billings:y,total_count:j.data.total_count});case 6:return t.abrupt("return",[]);case 7:case"end":return t.stop()}}),t)}))),function(e,t,n,r,c,o,l,d){return O.apply(this,arguments)})},{key:"billingsCountByStatus",value:(j=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r,c){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.d)("get",Object(h.e)(h.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/billings_count_by_status")),{params:{billing_cycle_name:r,query_date:c},headers:Object(h.c)(!0)});case 2:if(200!==(o=e.sent).status){e.next=5;break}return e.abrupt("return",o.data.billings);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return j.apply(this,arguments)})},{key:"updateBillings",value:(f=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.d)("patch",Object(h.e)(h.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/update_billings")),{data:{billings:r},headers:Object(h.c)(!0)});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"cancel",value:(c=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.d)("patch",Object(h.e)(h.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/").concat(r,"/cancel")),{headers:Object(h.c)(!0)});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"finalize",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.d)("patch",Object(h.e)(h.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/").concat(r,"/finalize")),{headers:Object(h.c)(!0)});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"finalizeBillings",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(h.d)("patch",Object(h.e)(h.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/finalize_billings")),{params:{billing_ids:r},headers:Object(h.c)(!0)});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}()},430:function(e,t,n){var content=n(455);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(23).default)("2784d24a",content,!0,{sourceMap:!1})},454:function(e,t,n){"use strict";n(430)},455:function(e,t,n){var r=n(22)(!1);r.push([e.i,"img[data-v-7a84ee2f]{width:18px;height:18px}",""]),e.exports=r},546:function(e,t,n){"use strict";n.r(t);var r=n(4),c=(n(25),n(11),n(303),n(3)),o=n(5),l=n(408),d={props:{items:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!0},currentTab:{type:String,default:""}},data:function(){return{columns:[],editImage:"",isLoading:!1}},watch:{currentTab:function(e){this.renderColumnByProjectType()}},mounted:function(){this.renderColumnByProjectType()},methods:{convertPrice:o.c,renderColumnByProjectType:function(){var e=this,t={select:{type:"selection",width:60,align:"center"},number:{key:"no",width:120,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.no")))}},houseNumber:{key:"address_number",width:150,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.house_number")))}},model:{key:"asset_model",width:150,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.model")))}},modelType:{key:"asset_type",width:150,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.model_type")))}},area:{key:"area",width:150,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.area")))}},usableArea:{key:"usable_area",width:150,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.usable_area")))}},billingCycle:{key:"billing_cycle",width:150,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.billing_cycle")))}},assetNumber:{key:"asset_number",width:100,align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.unit.label.asset_number")))}},addressNumber:{key:"address_number",width:160,sortable:"custom",align:"left",renderHeader:function(t,n){return t("span","".concat(e.$t("info.unit.label.address_number")))}},billingOwner:{slot:"billing_owner",key:"billing_owner",width:150,align:"center",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.billing_owner")))}},building:{key:"building",width:150,align:"center",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.building")))}},floor:{key:"floor",width:150,align:"center",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.floor")))}},previousMeter:{key:"previous_meter",width:200,align:"right",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.previous_meter")))}},currentMeter:{key:"current_meter",width:200,align:"right",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.current_meter")))}},unitUsage:{key:"amount",width:160,align:"right",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.unit_used")))}},pricePerUnit:{key:"price_per_unit",width:160,align:"right",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.price_per_unit")))}},amount:{key:"total_price",width:160,sortable:"custom",align:"right",renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.amount")))}},status:{key:"status",slot:"status",align:"center",width:160,sortable:"custom",renderHeader:function(t,n){return t("span","".concat(e.$t("info.user.label.status")))}},action:{slot:"action",align:"center",width:240,renderHeader:function(t,n){return t("span","".concat(e.$t("info.user.label.action")))}}},n=[t.number,t.billingCycle,t.assetNumber,t.addressNumber,t.billingOwner,t.building,t.floor,t.previousMeter,t.currentMeter,t.unitUsage,t.pricePerUnit,t.amount,t.status,t.action],r=[];switch(this.$store.getters.project.project_type){case"condominium":r=n;break;case"home_office":case"single_house":case"townhouse":r=[t.number,t.houseNumber,t.model,t.modelType,t.billingOwner,t.area,t.usableArea,t.previousMeter,t.currentMeter,t.unitUsage,t.pricePerUnit,t.amount,t.status,t.action];break;default:r=n}if("modified"===this.currentTab)r.splice(0,0,t.select);else if("paid"===this.currentTab){r.pop();var o=Object(c.findIndex)(r,{slot:"billing_owner"});o>-1&&r.splice(o,1)}else if("waiting_payment"===this.currentTab){var l=Object(c.findIndex)(r,{slot:"action"});l>-1&&r.splice(l,1);var d=Object(c.findIndex)(r,{slot:"billing_owner"});d>-1&&r.splice(d,1)}else if("cancelled"===this.currentTab){var f=Object(c.findIndex)(r,{slot:"billing_owner"});f>-1&&r.splice(f,1)}this.columns=r},handleSortChange:function(e){this.$emit("sortBy",e.key,e.order)},handleBeforeChange:function(e,t,n){var r=this;return new Promise((function(l){r.$Modal.confirm({title:r.$t("pages.confirm"),content:r.$t("messages.confirm_".concat(e)),okText:r.$t("button.yes"),cancelText:r.$t("button.no"),onOk:function(){"finalize"===e&&(Object(c.isNaN)(Number(n.previous_meter))||Object(c.isNaN)(Number(n.current_meter))||Object(c.isNaN)(Object(o.b)(n.price_per_unit)))?r.$Message.error({content:r.$t("messages.fill_data"),duration:6}):r.changeStatus(e,t)}})}))},changeStatus:function(e,t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l.a[e](n.$route.params.projectId,n.$route.params.billingId,t);case 2:200===(c=r.sent).status?(n.$Message.success({content:n.$t("messages.bill_status_".concat(c.data.billing.status)),duration:3}),n.$emit("reloadData")):c.data&&c.data.error?n.$Message.error({content:c.data.error,duration:8}):n.$Message.error({content:n.$t("messages.fail"),duration:8});case 4:case"end":return r.stop()}}),r)})))()},rowSelections:function(e){this.$emit("rowSelections",e)},convertIsBillingOwner:function(e){return e?this.$t("info.user.billing_owner.label.is_billing_owner"):this.$t("info.user.billing_owner.label.is_not_billing_owner")}}},f=(n(454),n(9)),component=Object(f.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isLoading?n("GLoading"):n("div",[n("Table",{attrs:{columns:e.columns,data:e.items,loading:e.loading,"no-data-text":e.$t("pages.no_data")},on:{"on-selection-change":e.rowSelections,"on-sort-change":e.handleSortChange},scopedSlots:e._u([{key:"status",fn:function(e){var t=e.row;return[n("GStatusLabelPreview",{attrs:{status:t.status}})]}},{key:"billing_owner",fn:function(t){var n=t.row;return[e._v("\n      "+e._s(e.convertIsBillingOwner(n.billing_owner)||"-")+"\n    ")]}},{key:"action",fn:function(t){var r=t.row;return[["draft","modified","ready","waiting_payment"].includes(r.status)?n("Tooltip",{attrs:{content:e.$t("button.edit"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{size:"20",type:"ios-create-outline"},on:{click:function(t){return e.$emit("extraFunctionWithObject",r)}}})],1):e._e(),e._v(" "),["modified"].includes(r.status)?n("Tooltip",{attrs:{content:e.$t("button.finalize"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-checkmark-circle-outline",size:"20"},on:{click:function(t){return e.handleBeforeChange("finalize",r.id,r)}}})],1):e._e(),e._v(" "),["draft","modified","ready"].includes(r.status)?n("Tooltip",{attrs:{content:e.$t("button.cancel"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-close-circle-outline",size:"20"},on:{click:function(t){return e.handleBeforeChange("cancel",r.id)}}})],1):e._e()]}}])})],1)}),[],!1,null,"7a84ee2f",null);t.default=component.exports}}]);