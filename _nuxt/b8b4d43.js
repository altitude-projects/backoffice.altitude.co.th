(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{406:function(e,t,n){"use strict";n.d(t,"a",(function(){return Y}));n(15),n(18),n(32),n(33);var r=n(4),o=n(7),c=n(30),l=n(31),d=(n(21),n(25),n(3)),f=n(6),m=n(5);function h(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function _(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,e),this.json=_(_({},t),{},{first_name_translations:t.first_name_translations||{en:"",th:""},last_name_translations:t.last_name_translations||{en:"",th:""},title_translations:t.title_translations||{en:"",th:""}})}var t,n,o,h,Y,j,v;return Object(l.a)(e,[{key:"resetPassword",value:(v=Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("patch",Object(f.e)(f.b,"reset_password"),{data:{user:this.json},headers:Object(f.c)(!0)});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"forgetPassword",value:(j=Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("patch",Object(f.e)(f.b,"forgot_password"),{data:{user:this.json},headers:Object(f.c)(!0)});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"save",value:(Y=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,(r=Object(m.e)(this.json,"user")).juristic_person="yes"===r.juristic_person,o=Object(m.n)({user:r,addresses:t},null,["profile_image"]),!this.json.id){e.next=10;break}return e.next=7,Object(f.d)("patch",Object(f.e)(f.a,"users/".concat(this.json.id)),{headers:Object(f.c)(!0),data:o});case 7:n=e.sent,e.next=13;break;case 10:return e.next=12,Object(f.d)("post",Object(f.e)(f.a,"users"),{headers:Object(f.c)(!0),data:o});case 12:n=e.sent;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"asInfoJson",value:function(){return{addresses:this.json.addresses,no:this.json.no,customer_code:this.json.customer_code||"-",customer_type:this.json.customer_type||"-",date_of_birth:this.json.date_of_birth?Object(m.g)(this.json.date_of_birth):"-",display_name:this.json.display_name?this.json.display_name:"-",email:this.json.email||"-",facebook:this.json.facebook||"-",full_name:this.fullName(),gender:this.json.gender,id:this.json.id,issue_at:this.json.issue_at||"-",juristic_person:this.json.juristic_person,language:this.json.language||"-",line:this.json.line||"-",marital_status:this.json.marital_status,mobile_primary:this.json.mobile_primary||"-",mobile_secondary:this.json.mobile_secondary||"-",nationality:Object(d.startCase)(this.json.nationality),passport_country:this.json.passport_country||"-",passport_number:this.json.passport_number||"-",profile_image:this.json.profile_image||null,race:Object(d.startCase)(this.json.race),telephone_oversea:this.json.telephone_oversea||"-",telephone:this.json.telephone||"-",thai_id_number:this.json.thai_id_number||"-",user_assets:this.json.user_assets,wechat:this.json.wechat||"-",whatsapp:this.json.whatsapp||"-"}}},{key:"fullName",value:function(){var e=[],t=[];return this.json.first_name_translations&&Object.keys(this.json.first_name_translations).length>0&&(e.push(this.json.first_name_translations.th),t.push(this.json.first_name_translations.en)),this.json.last_name_translations&&Object.keys(this.json.last_name_translations).length>0&&(e.push(this.json.last_name_translations.th),t.push(this.json.last_name_translations.en)),{th:e.join(" "),en:t.join(" ")}}}],[{key:"index",value:(h=Object(r.a)(regeneratorRuntime.mark((function t(n,r,o,c){var l,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.d)("get",Object(f.e)(f.a,"projects/".concat(n,"/user_assets")),{params:{page:r,per_page:o,search:c},headers:Object(f.c)(!0)});case 2:if(200!==(l=t.sent).status){t.next=6;break}return m=Object(d.map)(l.data.users,(function(t){return new e(t)})),t.abrupt("return",{users:m,total_count:l.data.total_count});case 6:return t.abrupt("return",[]);case 7:case"end":return t.stop()}}),t)}))),function(e,t,n,r){return h.apply(this,arguments)})},{key:"show",value:(o=Object(r.a)(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.d)("get",Object(f.e)(f.a,"users/".concat(n)),{headers:Object(f.c)(!0)});case 2:if(200!==(r=t.sent).status){t.next=5;break}return t.abrupt("return",new e(r.data.user));case 5:case"end":return t.stop()}}),t)}))),function(e){return o.apply(this,arguments)})},{key:"destroy",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("delete",Object(f.e)(f.a,"users/".concat(t)),{headers:Object(f.c)(!0)});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"importUserAssets",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("file",n),e.next=4,Object(f.d)("post",Object(f.e)(f.a,"projects/".concat(t,"/assets/import_user_assets")),{headers:Object(f.c)(!0,!0),data:r});case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),e}()},409:function(e,t,n){"use strict";n.d(t,"a",(function(){return Y}));n(21),n(15),n(18),n(32),n(33);var r=n(4),o=n(7),c=n(30),l=n(31),d=(n(16),n(25),n(3)),f=n(6),m=n(5);function h(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function _(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,e),this.json=_(_({},t),{},{area:t.area||0})}var t,n,o,h,Y,j,v;return Object(l.a)(e,[{key:"save",value:(v=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,r=Object(m.e)(this.json,"unit"),!this.json.id){e.next=8;break}return e.next=5,Object(f.d)("patch",Object(f.e)(f.a,"projects/".concat(t,"/assets/").concat(this.json.id)),{headers:Object(f.c)(!0),data:r});case 5:n=e.sent,e.next=11;break;case 8:return e.next=10,Object(f.d)("post",Object(f.e)(f.a,"projects/".concat(t,"/assets")),{headers:Object(f.c)(!0),data:r});case 10:n=e.sent;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"asTableJson",value:function(e,t){return{id:this.json.id,no:(t-1)*e+this.json.no,address_number:this.json.address_number||"-",asset_number:this.json.asset_number||"-",asset_model:this.json.asset_model||"-",asset_type_name:this.json.asset_type.name,building:this.json.building||"-",usable_area:this.json.usable_area||"-",area:this.json.area||"-",phase:this.json.phase||"-",floor:this.json.floor||"-",property_type:this.json.property_type||"-"}}}],[{key:"index",value:(j=Object(r.a)(regeneratorRuntime.mark((function t(n,r,o,c){var l,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.d)("get",Object(f.e)(f.a,"projects/".concat(n,"/assets")),{headers:Object(f.c)(!0),params:{search:r,page:o,per_page:c}});case 2:if(l=t.sent,m=Object(d.orderBy)(l.data.assets,["address_number"],["asc"]),200!==l.status){t.next=7;break}return m=Object(d.map)(m,(function(t,n){return t.no=n+1,new e(t)})),t.abrupt("return",{units:m,total_count:l.data.total_count});case 7:return t.abrupt("return",[]);case 8:case"end":return t.stop()}}),t)}))),function(e,t,n,r){return j.apply(this,arguments)})},{key:"show",value:(Y=Object(r.a)(regeneratorRuntime.mark((function t(n,r){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.d)("get",Object(f.e)(f.a,"projects/".concat(n,"/assets/").concat(r)),{headers:Object(f.c)(!0)});case 2:if(200!==(o=t.sent).status){t.next=5;break}return t.abrupt("return",new e(o.data.asset));case 5:case"end":return t.stop()}}),t)}))),function(e,t){return Y.apply(this,arguments)})},{key:"destroy",value:(h=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("delete",Object(f.e)(f.a,"projects/".concat(t,"/assets/").concat(n)),{headers:Object(f.c)(!0)});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return h.apply(this,arguments)})},{key:"assetBillings",value:(o=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("get",Object(f.e)(f.a,"projects/".concat(t,"/assets/").concat(n,"/asset_billings")),{headers:Object(f.c)(!0)});case 2:if(200!==(r=e.sent).status){e.next=5;break}return e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"importAssets",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("file",n),e.next=4,Object(f.d)("post",Object(f.e)(f.a,"projects/".concat(t,"/assets/import_assets")),{headers:Object(f.c)(!0,!0),data:r});case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"importAssetSupplies",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new FormData).append("file",n),o.append("images_zip_file",r),e.next=5,Object(f.d)("post",Object(f.e)(f.a,"projects/".concat(t,"/assets/import_asset_supplies")),{headers:Object(f.c)(!0,!0),data:o});case 5:return c=e.sent,e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}()},521:function(e,t,n){var content=n(644);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(23).default)("3da2b78c",content,!0,{sourceMap:!1})},643:function(e,t,n){"use strict";n(521)},644:function(e,t,n){var r=n(22)(!1);r.push([e.i,".ivu-table[data-v-1faa75a2]{margin:0!important}.auto-complete-invoice[data-v-1faa75a2] .ivu-select-dropdown{max-height:300px!important}.white-space-normal[data-v-1faa75a2]{white-space:normal}",""]),e.exports=r},794:function(e,t,n){"use strict";n.r(t);var r=n(4),o=(n(25),n(16),n(11),n(48),n(3)),c=n(1),l=n.n(c),d=n(409),f=n(406),m=n(408),h=n(427),_={props:{isNew:{type:Boolean,default:!1},visibleModal:{type:Boolean,default:!1}},data:function(){var e=this;return{disabledButton:!1,formData:new h.a,units:[],unitSelected:{},users:[],assetBillings:[],waterBillings:[],maintenanceBillings:[],otherBillings:[],loading:!1,waterColumns:[{type:"selection",key:"id",width:60,align:"center"},{key:"billing_cycle",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.billing_cycle")))}},{key:"previous_meter",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.previous_meter")))}},{key:"current_meter",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.current_meter")))}},{key:"amount",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.unit_used")))}},{key:"price_per_unit",align:"center",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.price_per_unit")))}},{key:"total_price",align:"center",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.amount")))}},{slot:"status",align:"center",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.status")))}}],maintenanceColumns:[{type:"selection",key:"id",width:60,align:"center"},{key:"billing_cycle",width:200,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.billing_cycle")))}},{slot:"payment_type",width:200,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.payment_type")))}},{key:"amount",width:200,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.usable_area")))}},{key:"price_per_unit",align:"center",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.price_per_sqm")))}},{key:"total_price",align:"center",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.amount")))}},{slot:"status",align:"center",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.status")))}}],otherColumns:[{type:"selection",key:"id",width:60,align:"center"},{key:"name",width:200,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.billing_name")))}},{key:"from_datetime",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.from")))}},{key:"to_datetime",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.to")))}},{key:"price_per_unit",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.price_per_unit")))}},{key:"amount",align:"center",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.unit_used")))}},{key:"total_price",align:"center",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.amount")))}},{slot:"status",align:"center",width:90,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.status")))}}]}},computed:{projectType:function(){return!Object(o.includes)(["townhouse","home_office","single_house"],this.$store.state.project.project_type)},months:function(){return[{en:"January ".concat(l()().format("YYYY")),th:"มกราคม ".concat(l()().format("YYYY")),value:"มกราคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"February ".concat(l()().format("YYYY")),th:"กุมภาพันธ์ ".concat(l()().format("YYYY")),value:"กุมภาพันธ์ ".concat(l()().add(543,"year").format("YYYY"))},{en:"March ".concat(l()().format("YYYY")),th:"มีนาคม ".concat(l()().format("YYYY")),value:"มีนาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"April ".concat(l()().format("YYYY")),th:"เมษายน ".concat(l()().format("YYYY")),value:"เมษายน ".concat(l()().add(543,"year").format("YYYY"))},{en:"May ".concat(l()().format("YYYY")),th:"พฤษภาคม ".concat(l()().format("YYYY")),value:"พฤษภาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"June ".concat(l()().format("YYYY")),th:"มิถุนายน ".concat(l()().format("YYYY")),value:"มิถุนายน ".concat(l()().add(543,"year").format("YYYY"))},{en:"July ".concat(l()().format("YYYY")),th:"กรกฏาคม ".concat(l()().format("YYYY")),value:"กรกฏาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"August ".concat(l()().format("YYYY")),th:"สิงหาคม ".concat(l()().format("YYYY")),value:"สิงหาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"September ".concat(l()().format("YYYY")),th:"กันยายน ".concat(l()().format("YYYY")),value:"กันยายน ".concat(l()().add(543,"year").format("YYYY"))},{en:"October ".concat(l()().format("YYYY")),th:"ตุลาคม ".concat(l()().format("YYYY")),value:"ตุลาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"November ".concat(l()().format("YYYY")),th:"พฤศจิกายน ".concat(l()().format("YYYY")),value:"พฤศจิกายน ".concat(l()().add(543,"year").format("YYYY"))},{en:"December ".concat(l()().format("YYYY")),th:"ธันวาคม ".concat(l()().format("YYYY")),value:"ธันวาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"January ".concat(l()().add(1,"year").format("YYYY")),th:"มกราคม ".concat(l()().add(1,"year").format("YYYY")),value:"มกราคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"February ".concat(l()().add(1,"year").format("YYYY")),th:"กุมภาพันธ์ ".concat(l()().add(1,"year").format("YYYY")),value:"กุมภาพันธ์ ".concat(l()().add(544,"year").format("YYYY"))},{en:"March ".concat(l()().add(1,"year").format("YYYY")),th:"มีนาคม ".concat(l()().add(1,"year").format("YYYY")),value:"มีนาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"April ".concat(l()().add(1,"year").format("YYYY")),th:"เมษายน ".concat(l()().add(1,"year").format("YYYY")),value:"เมษายน ".concat(l()().add(544,"year").format("YYYY"))},{en:"May ".concat(l()().add(1,"year").format("YYYY")),th:"พฤษภาคม ".concat(l()().add(1,"year").format("YYYY")),value:"พฤษภาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"June ".concat(l()().add(1,"year").format("YYYY")),th:"มิถุนายน ".concat(l()().add(1,"year").format("YYYY")),value:"มิถุนายน ".concat(l()().add(544,"year").format("YYYY"))},{en:"July ".concat(l()().add(1,"year").format("YYYY")),th:"กรกฏาคม ".concat(l()().add(1,"year").format("YYYY")),value:"กรกฏาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"August ".concat(l()().add(1,"year").format("YYYY")),th:"สิงหาคม ".concat(l()().add(1,"year").format("YYYY")),value:"สิงหาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"September ".concat(l()().add(1,"year").format("YYYY")),th:"กันยายน ".concat(l()().add(1,"year").format("YYYY")),value:"กันยายน ".concat(l()().add(544,"year").format("YYYY"))},{en:"October ".concat(l()().add(1,"year").format("YYYY")),th:"ตุลาคม ".concat(l()().add(1,"year").format("YYYY")),value:"ตุลาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"November ".concat(l()().add(1,"year").format("YYYY")),th:"พฤศจิกายน ".concat(l()().add(1,"year").format("YYYY")),value:"พฤศจิกายน ".concat(l()().add(544,"year").format("YYYY"))},{en:"December ".concat(l()().add(1,"year").format("YYYY")),th:"ธันวาคม ".concat(l()().add(1,"year").format("YYYY")),value:"ธันวาคม ".concat(l()().add(544,"year").format("YYYY"))}]}},watch:{visibleModal:function(){this.resetAllFields()},"formData.json.asset_label":function(){this.checkDisableSubmit()},"formData.json.user_id":function(){this.checkDisableSubmit()},"formData.json.due_datetime":function(){this.checkDisableSubmit()},"formData.json.period":function(){this.checkDisableSubmit()}},mounted:function(){this.checkDisableSubmit()},methods:{checkDisableSubmit:function(){this.formData.json.asset_label&&this.formData.json.user_id&&this.formData.json.due_datetime&&this.formData.json.period&&this.formData.json.billing_ids&&this.formData.json.billing_ids.length>0?this.disabledButton=!1:this.disabledButton=!0},searchUnit:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e&&e.length>2)){n.next=9;break}return t.formData.json.user_id="",t.units=[],n.next=5,d.a.index(t.$route.params.projectId,e);case 5:r=n.sent,t.units=Object(o.map)(r.units,(function(u){return{label:u.json.address_number,assetNumber:u.json.asset_number,address:u.json.address_number,floor:u.json.floor,building:u.json.building,value:u.json.id,phase:u.json.phase,assetModel:u.json.asset_model,unitType:u.json.asset_type.name}})),n.next=13;break;case 9:t.resetUnits(),t.formData.json.asset_id="",t.formData.json.asset_label="",t.formData.json.user_id="";case 13:case"end":return n.stop()}}),n)})))()},onSelect:function(e){this.formData.json.user_id="";var t=Object(o.find)(this.units,{label:e});this.unitSelected.asset_id!==t.value&&(this.unitSelected.asset_id=t.value,this.formData.json.asset_id=t.value,this.formData.json.asset_label=t.label,this.formData.json.asset_id&&(this.fetchUnit(),this.fetchAssetBillings()))},fetchAssetBillings:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.a.assetBillings(e.$route.params.projectId,e.formData.json.asset_id);case 2:return n=t.sent,t.next=5,Object(o.map)(n.water_billings,(function(e){return new m.a(e).asTableJson()}));case 5:return e.waterBillings=t.sent,t.next=8,Object(o.map)(n.maintenance_fee_billings,(function(e){return new m.a(e).asTableJson()}));case 8:return e.maintenanceBillings=t.sent,t.next=11,Object(o.map)(n.other_billings,(function(e){return new m.a(e).asTableJson()}));case 11:e.otherBillings=t.sent,e.waterBillings.length||e.maintenanceBillings.length||e.otherBillings.length?e.disabledButton=!1:e.disabledButton=!0;case 13:case"end":return t.stop()}}),t)})))()},fetchUnit:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,d.a.show(e.$route.params.projectId,e.formData.json.asset_id);case 3:n=t.sent,r=Object(o.map)(n.json.user_assets,(function(u){var t=new f.a(u.user);return{id:t.json.id,en:"".concat(t.fullName().en," (").concat(e.convertRole(u.role),")"),th:"".concat(t.fullName().th," (").concat(e.convertRole(u.role),")"),label:"".concat(t.fullName().en," ").concat(t.fullName().th),is_billing_owner:u.is_billing_owner}})),(c=Object(o.filter)(r,{is_billing_owner:!0})).length>0?(e.users=c,e.formData.json.user_id=e.users[0].id):e.users=r,e.loading=!1;case 8:case"end":return t.stop()}}),t)})))()},convertRole:function(e){return"owner"===e?this.$t("info.user.label.role_owner"):"family"===e?this.$t("info.user.label.role_family"):this.$t("info.user.label.role_tenant")},handleClose:function(){this.$emit("closeModal"),this.resetAllFields()},resetAllFields:function(){this.resetUnits(),this.$refs.form.resetFields()},resetUnits:function(){this.waterBillings.length&&this.$refs.waterSelection.selectAll(!1),this.maintenanceBillings.length&&this.$refs.maintenanceSelection.selectAll(!1),this.otherBillings.length&&this.$refs.otherSelection.selectAll(!1),this.formData.json.billing_ids=[],this.waterBillings=[],this.maintenanceBillings=[],this.otherBillings=[],this.users=[],this.units=[],this.unitSelected={}},handleSubmit:function(){var e=this;return new Promise((function(t){e.$Modal.confirm({title:e.$t("messages.confirm"),content:e.$t("messages.confirm_save"),okText:e.$t("button.yes"),cancelText:e.$t("button.no"),onOk:function(){e.submitForm()}})}))},rowSelections:function(){this.formData.json.billing_ids=this.getBillingIds(),this.checkDisableSubmit()},getBillingIds:function(){var e=[],t=[],n=[];return this.waterBillings.length&&(e=this.$refs.waterSelection.getSelection().map((function(select){return select.id}))),this.maintenanceBillings.length&&(t=this.$refs.maintenanceSelection.getSelection().map((function(select){return select.id}))),this.otherBillings.length&&(n=this.$refs.otherSelection.getSelection().map((function(select){return select.id}))),e.concat(t,n)||[]},submitForm:function(){var e=this;this.formData.json.billing_ids&&this.formData.json.billing_ids.length?this.$refs.form.validate(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n&&e.formData.json.billing_ids&&e.formData.json.billing_ids.length>0)){t.next=5;break}return t.next=3,e.formData.save(e.$route.params.projectId);case 3:(r=t.sent).data&&r.data.success?(e.$Message.success({content:e.$t("pages.invoice")+e.$t("messages.successfully_created"),duration:3}),e.$emit("reloadData"),e.handleClose()):r.data&&r.data.error?e.$Message.error({content:r.data.error,duration:8}):e.$Message.error({content:e.$t("messages.fail"),duration:8});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()):this.$Message.error(this.$t("messages.please_select_billing"))}}},Y=(n(643),n(9)),component=Object(Y.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Card",{attrs:{"dis-hover":"",bordered:!1}},[n("p",{attrs:{slot:"title"},slot:"title"},[e._v("\n      "+e._s(e.isNew?e.$t("button.new"):e.$t("button.edit"))+e._s(e.$t("pages.invoice"))+"\n    ")]),e._v(" "),n("Form",{ref:"form",attrs:{model:e.formData.json,"label-position":"top"}},[n("Row",{attrs:{type:"flex",gutter:16,justify:"center"}},[n("Col",{attrs:{xs:24,sm:8}},[n("FormItem",{attrs:{prop:"asset_label",label:e.$t("form.invoice.label.unit"),rules:[{required:!0,message:this.$t("form.invoice.label.unit")+" "+this.$t("error.cannot_be_blank"),trigger:"blur,change"}]}},[n("AutoComplete",{staticClass:"auto-complete-invoice",attrs:{icon:"ios-search",clearable:"",placeholder:e.$t("form.invoice.placeholder.unit")},on:{"on-change":e.searchUnit,"on-clear":e.searchUnit,"on-select":e.onSelect},model:{value:e.formData.json.asset_label,callback:function(t){e.$set(e.formData.json,"asset_label",t)},expression:"formData.json.asset_label"}},e._l(e.units,(function(t){return n("Option",{key:t.value,attrs:{value:t.label}},[e.projectType?n("div",[n("Row",[n("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[e._v("\n                      "+e._s(e.$t("info.unit.label.unit_number"))+":\n                      "+e._s(t.assetNumber)+"\n                    ")]),e._v(" "),n("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[e._v("\n                      "+e._s(e.$t("info.unit.label.floor"))+": "+e._s(t.floor)+"\n                    ")])],1),e._v(" "),n("Row",[n("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[e._v("\n                      "+e._s(e.$t("info.unit.label.address"))+": "+e._s(t.address)+"\n                    ")]),e._v(" "),n("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[e._v("\n                      "+e._s(e.$t("info.unit.label.building"))+":\n                      "+e._s(t.building)+"\n                    ")])],1)],1):n("div",[n("Row",[n("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[e._v("\n                      "+e._s(e.$t("info.unit.label.asset_model"))+":\n                      "+e._s(t.assetModel)+"\n                    ")]),e._v(" "),n("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[e._v("\n                      "+e._s(e.$t("info.unit.label.phase"))+": "+e._s(t.phase)+"\n                    ")])],1),e._v(" "),n("Row",[n("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[e._v("\n                      "+e._s(e.$t("info.unit.label.address"))+": "+e._s(t.address)+"\n                    ")]),e._v(" "),n("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[e._v("\n                      "+e._s(e.$t("info.unit.label.asset_type"))+":\n                      "+e._s(t.unitType)+"\n                    ")])],1)],1)])})),1)],1)],1),e._v(" "),n("Col",{attrs:{xs:24,sm:8}},[n("FormItem",{attrs:{prop:"user_id",label:e.$t("form.invoice.label.resident"),rules:[{required:!0,message:this.$t("form.invoice.label.resident")+" "+this.$t("error.cannot_be_blank"),trigger:"blur,change"}]}},[n("Select",{attrs:{placeholder:e.$t("form.invoice.placeholder.resident"),filterable:"",clearable:""},model:{value:e.formData.json.user_id,callback:function(t){e.$set(e.formData.json,"user_id",t)},expression:"formData.json.user_id"}},e._l(e.users,(function(t){return n("Option",{key:t.id,attrs:{value:t.id,label:t[e.$store.state.language.value]}})})),1)],1)],1),e._v(" "),n("Col",{attrs:{xs:24,sm:8}},[n("FormItem",{attrs:{prop:"due_datetime",label:e.$t("form.invoice.label.due_datetime"),rules:[{required:!0,type:"date",message:this.$t("form.invoice.label.due_datetime")+" "+this.$t("error.cannot_be_blank"),trigger:"blur,change"}]}},[n("DatePicker",{staticStyle:{width:"100%"},attrs:{format:"dd/MM/yyyy",type:"date",placeholder:e.$t("form.invoice.placeholder.due_datetime")},model:{value:e.formData.json.due_datetime,callback:function(t){e.$set(e.formData.json,"due_datetime",t)},expression:"formData.json.due_datetime"}})],1)],1)],1),e._v(" "),n("Row",{attrs:{type:"flex",gutter:16,justify:"start"}},[n("Col",{attrs:{xs:24,sm:8}},[n("FormItem",{attrs:{prop:"period",label:e.$t("form.invoice.label.period"),rules:[{required:!0,message:this.$t("form.invoice.label.period")+" "+this.$t("error.cannot_be_blank"),trigger:"blur,change"}]}},[n("Select",{attrs:{placeholder:e.$t("form.invoice.placeholder.period"),filterable:"",transfer:"",clearable:""},model:{value:e.formData.json.period,callback:function(t){e.$set(e.formData.json,"period",t)},expression:"formData.json.period"}},e._l(e.months,(function(t){return n("Option",{key:t.th,attrs:{value:t.value,label:t[e.$store.state.language.value]}},[e._v("\n                "+e._s(t[e.$store.state.language.value])+"\n              ")])})),1)],1)],1),e._v(" "),n("Col",{attrs:{xs:24,sm:8}},[n("FormItem",{attrs:{prop:"note",label:e.$t("form.invoice.label.note")}},[n("Input",{attrs:{maxlength:"500","show-word-limit":""},model:{value:e.formData.json.note,callback:function(t){e.$set(e.formData.json,"note",t)},expression:"formData.json.note"}})],1)],1)],1)],1),e._v(" "),n("Row",{attrs:{type:"flex",justify:"center"}},[n("Col",{attrs:{xs:24}},[e.waterBillings.length?n("div",[n("h3",[e._v("\n            "+e._s(e.$t("pages.water_billing"))+"\n          ")]),e._v(" "),n("Table",{ref:"waterSelection",staticClass:"ma-0",attrs:{columns:e.waterColumns,data:e.waterBillings},on:{"on-selection-change":e.rowSelections},scopedSlots:e._u([{key:"status",fn:function(e){var t=e.row;return[n("GStatusLabelPreview",{attrs:{status:t.status}})]}}],null,!1,3459625419)})],1):e._e(),e._v(" "),e.maintenanceBillings.length?n("div",[n("h3",[e._v(e._s(e.$t("pages.maintenance_fee")))]),e._v(" "),n("Table",{ref:"maintenanceSelection",staticClass:"ma-0",attrs:{columns:e.maintenanceColumns,data:e.maintenanceBillings},on:{"on-selection-change":e.rowSelections},scopedSlots:e._u([{key:"status",fn:function(e){var t=e.row;return[n("GStatusLabelPreview",{attrs:{status:t.status}})]}},{key:"payment_type",fn:function(t){var n=t.row;return[e._v("\n              "+e._s(n.payment_type?e.$t("info.invoice.label."+n.payment_type):"")+"\n            ")]}}],null,!1,3441746446)})],1):e._e(),e._v(" "),e.otherBillings.length?n("div",[n("h3",[e._v(e._s(e.$t("pages.other_billing")))]),e._v(" "),n("Table",{ref:"otherSelection",staticClass:"ma-0",attrs:{columns:e.otherColumns,data:e.otherBillings},on:{"on-selection-change":e.rowSelections},scopedSlots:e._u([{key:"status",fn:function(e){var t=e.row;return[n("GStatusLabelPreview",{attrs:{status:t.status}})]}}],null,!1,3459625419)})],1):e._e(),e._v(" "),e.waterBillings.length<1&&e.maintenanceBillings.length<1&&e.otherBillings.length<1?n("div",{staticClass:"text-center"},[n("Card",{attrs:{"dis-hover":""}},[e._v("\n            "+e._s(e.$t("pages.no_bill_data"))+"\n          ")])],1):e._e()]),e._v(" "),n("Col",{staticClass:"text-center mt-20",attrs:{xs:24}},[n("Button",{staticClass:"default-button button-grey",on:{click:function(t){return e.handleClose()}}},[e._v("\n          "+e._s(e.$t("button.cancel"))+"\n        ")]),e._v(" "),n("Button",{staticClass:"default-button button-green",attrs:{disabled:e.disabledButton},on:{click:function(t){return e.handleSubmit()}}},[e._v("\n          "+e._s(e.$t("button.save"))+"\n        ")])],1)],1)],1)],1)}),[],!1,null,"1faa75a2",null);t.default=component.exports}}]);