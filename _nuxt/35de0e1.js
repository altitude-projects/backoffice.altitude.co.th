(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{555:function(e,t,n){"use strict";n.r(t);var o=n(4),r=(n(25),n(18),n(41),n(11),n(427)),c=n(84),l={props:{items:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!0},extraData:{type:Object,default:function(){return{}}},currentTab:{type:String,default:""}},data:function(){var e=this;return{columns:[{key:"no",width:80,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.no")))}},{slot:"invoice_number",width:140,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.invoice_number")))}},{title:this.$t("info.invoice.label.room"),key:"room",width:100,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.room")))}},{key:"address",width:100,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.address")))}},{key:"name",width:100,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.unit_type")))}},{key:"total_price",width:100,align:"right",renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.amount")))}},{key:"due_datetime",width:110,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.due_datetime")))}},{key:"created_at",width:110,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.create_date")))}},{key:"created_by",align:"center",width:120,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.created_by")))}},{key:"updated_at",width:110,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.payment_datetime")))}},{key:"received_by",align:"center",width:120,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.received_by")))}},{key:"cancelled_at",width:110,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.cancelled_at")))}},{key:"cancelled_by",align:"center",width:120,renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.cancelled_by")))}},{slot:"status",width:160,align:"center",renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.status")))}},{slot:"action",width:110,align:"center",renderHeader:function(t,n){return t("span","".concat(e.$t("info.invoice.label.action")))}}]}},watch:{extraData:function(e){"cancelled"===e.tab&&(this.columns=this.columns.filter((function(e){return"action"!==e.slot})))}},mounted:function(){this.checkColumns()},methods:{checkColumns:function(){"cancelled"===this.extraData.tab?this.columns=this.columns.filter((function(e){return"action"!==e.slot&&"received_by"!==e.key&&"updated_at"!==e.key&&"created_by"!==e.key})):"waiting_payment"===this.extraData.tab?this.columns=this.columns.filter((function(e){return"received_by"!==e.key&&"updated_at"!==e.key&&"cancelled_by"!==e.key&&"cancelled_at"!==e.key})):this.columns=this.columns.filter((function(e){return"cancelled_by"!==e.key&&"cancelled_at"!==e.key})),["home_office","single_house","townhouse"].includes(this.$store.getters.project.project_type)&&(this.columns=this.columns.filter((function(e){return"room"!==e.key})))},handleBeforeChange:function(e,t){var n=this;return new Promise((function(o){n.$Modal.confirm({title:n.$t("pages.confirm"),content:n.$t("messages.confirm_".concat(e),{text:"invoice"}),okText:n.$t("button.yes"),cancelText:n.$t("button.no"),onOk:function(){n.changeStatus(e,t)}})}))},changeStatus:function(e,t){var n=this;return Object(o.a)(regeneratorRuntime.mark((function o(){var c;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if("pay"!==e){o.next=6;break}return o.next=3,r.a.pay(n.$route.params.projectId,t);case 3:c=o.sent,o.next=9;break;case 6:return o.next=8,r.a.cancel(n.$route.params.projectId,t);case 8:c=o.sent;case 9:200===c.status?(n.$Message.success({content:n.$t("messages.invoice_status_".concat(c.data.invoice.status)),duration:3}),n.$emit("reloadData")):c.data&&c.data.error?n.$Message.error({content:c.data.error,duration:8}):n.$Message.error({content:n.$t("messages.fail"),duration:8});case 10:case"end":return o.stop()}}),o)})))()},exportPdf:function(e,t){var n="waiting_payment"===t?"export_pdf":"export_receipt_pdf",o=Object(c.a)(),r=this.$route.params.projectId,l="".concat("https://altitudeapp.altitude.co.th","/api/v1/download/projects/").concat(r,"/invoices/").concat(e,"/").concat(n,"?auth-token=").concat(o);window.open(l,"_blank")}}},d=n(9),component=Object(d.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Table",{attrs:{columns:e.columns,data:e.items,loading:e.loading,"no-data-text":e.$t("pages.no_data")},scopedSlots:e._u([{key:"invoice_number",fn:function(t){var o=t.row;return[n("nuxt-link",{attrs:{to:{name:"projects-projectId-billings-invoices-invoiceId-show",params:{projectId:e.$route.params.projectId,invoiceId:o.id}}}},[n("Row",{attrs:{type:"flex"}},[n("Col",[n("span",[e._v("\n            "+e._s(o.invoice_number)+"\n          ")])])],1)],1)]}},{key:"status",fn:function(e){var t=e.row;return[n("GStatusLabelPreview",{attrs:{status:t.status}})]}},{key:"action",fn:function(t){var o=t.row;return[n("div",{staticClass:"py-3"},[["waiting_payment"].includes(o.status)?n("Tooltip",{attrs:{content:e.$t("button.pay"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-cash-outline",size:"20"},on:{click:function(t){return e.handleBeforeChange("pay",o.id)}}})],1):e._e(),e._v(" "),["waiting_payment"].includes(o.status)?n("Tooltip",{attrs:{content:e.$t("button.cancel"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-close-circle-outline",size:"20"},on:{click:function(t){return e.handleBeforeChange("cancel",o.id)}}})],1):e._e(),e._v(" "),["waiting_payment","paid"].includes(o.status)?n("Tooltip",{attrs:{content:"waiting_payment"===o.status?e.$t("button.export_invoice"):e.$t("button.export_receipt"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-paper-outline",size:"20"},on:{click:function(t){return e.exportPdf(o.id,o.status)}}})],1):e._e()],1)]}}])})}),[],!1,null,"af3e52ae",null);t.default=component.exports}}]);