(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{424:function(t,e,n){"use strict";n.d(e,"a",(function(){return _}));var r=n(4),o=n(30),c=n(31),d=(n(25),n(3)),l=n(6),v=n(5),_=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,t),this.json=e,this.json.value=e.value||[]}var e,n,_;return Object(c.a)(t,[{key:"save",value:(_=Object(r.a)(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null,r=Object(v.e)(this.json,"configuration"),r=Object(v.n)(r,"configuration"),!this.json.id){t.next=9;break}return t.next=6,Object(l.d)("patch",Object(l.e)(l.a,"projects/".concat(e,"/configurations/").concat(this.json.id)),{data:r,headers:Object(l.c)(!0)});case 6:n=t.sent,t.next=12;break;case 9:return t.next=11,Object(l.d)("post",Object(l.e)(l.a,"projects/".concat(e,"/configurations")),{data:r,headers:Object(l.c)(!0)});case 11:n=t.sent;case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t,this)}))),function(t){return _.apply(this,arguments)})},{key:"asTableJson",value:function(){return{id:this.json.id,key:this.json.key,value:this.json.value}}}],[{key:"index",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.d)("get",Object(l.e)(l.a,"projects/".concat(n,"/configurations")),{headers:Object(l.c)(!0)});case 2:if(200!==(r=e.sent).status){e.next=5;break}return e.abrupt("return",Object(d.map)(r.data.configurations,(function(e){return new t(e)})));case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(t){return n.apply(this,arguments)})},{key:"show",value:(e=Object(r.a)(regeneratorRuntime.mark((function e(n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.d)("get",Object(l.e)(l.a,"projects/".concat(n,"/configurations/").concat(r)),{headers:Object(l.c)(!0)});case 2:if(200!==(o=e.sent).status){e.next=5;break}return e.abrupt("return",new t(o.data.configuration));case 5:return e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)}))),function(t,n){return e.apply(this,arguments)})}]),t}()},503:function(t,e,n){var content=n(610);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(23).default)("6cdf4318",content,!0,{sourceMap:!1})},609:function(t,e,n){"use strict";n(503)},610:function(t,e,n){var r=n(22)(!1);r.push([t.i,"[data-v-232643a4] .ivu-card-body{padding:20px 150px}@media screen and (max-width:1060px){[data-v-232643a4] .ivu-card-body{padding:20px}}.div-container[data-v-232643a4]{display:table;width:100%}.first-table[data-v-232643a4]{border-collapse:collapse}.first-table[data-v-232643a4],.table-company[data-v-232643a4]{border-spacing:0;width:100%;max-width:100%}.table-company[data-v-232643a4]{padding:3px}.table-company[data-v-232643a4],.table-no[data-v-232643a4]{font-size:12px;vertical-align:top}.table-no[data-v-232643a4]{border-spacing:0;width:80%;max-width:80%;text-align:right;float:right}.table-no td[data-v-232643a4]{border:1px solid #c9c9c9;padding:0 3px}.table-list[data-v-232643a4]{font-size:12px;border-spacing:0;width:100%;max-width:100%;vertical-align:top}.table-list th[data-v-232643a4]{text-align:center;padding:8px;border:1px solid #c9c9c9}.table-list td[data-v-232643a4]{border:1px solid #c9c9c9;padding:3px}.extra-button[data-v-232643a4]{display:flex;justify-content:space-between}",""]),t.exports=r},753:function(t,e,n){"use strict";n.r(e);var r=n(4),o=(n(25),n(303),n(11),n(83),n(3)),c=n(427),d=n(84),l=n(424),v=n(5),_={data:function(){return{invoice:{},isLoading:!1,configuration:{},billingAmount:""}},mounted:function(){this.fetchInvoice()},methods:{formatDate:v.g,convertPrice:v.c,numberToThai:v.l,fetchInvoice:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.next=3,c.a.show(t.$route.params.projectId,t.$route.params.invoiceId);case 3:n=e.sent,t.invoice=n.asInfoJson(),t.billingAmount=Object(o.sumBy)(t.invoice.billings,(function(b){if(b.total_price){var t=Object(v.b)(b.total_price);return Number(t)}return 0})),t.fetchConfigurations(),t.isLoading=!1;case 8:case"end":return e.stop()}}),e)})))()},fetchConfigurations:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.index(t.$route.params.projectId);case 2:n=e.sent,r=Object(o.find)(n,(function(t){return"billing_info"===t.json.key})).json,c={},Object(o.forEach)(r.value,(function(t){c[t.key]=t.value})),t.configuration=c;case 7:case"end":return e.stop()}}),e)})))()},handleBeforeChange:function(t,e){var n=this;return new Promise((function(r){n.$Modal.confirm({title:n.$t("pages.confirm"),content:n.$t("messages.confirm_".concat(t),{text:"invoice"}),okText:n.$t("button.yes"),cancelText:n.$t("button.no"),onOk:function(){n.changeStatus(t,e)}})}))},changeStatus:function(t,e){var n=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("pay"!==t){r.next=6;break}return r.next=3,c.a.pay(n.$route.params.projectId,e);case 3:o=r.sent,r.next=9;break;case 6:return r.next=8,c.a.cancel(n.$route.params.projectId,e);case 8:o=r.sent;case 9:200===o.status?(n.$Message.success({content:n.$t("messages.invoice_status_".concat(o.data.invoice.status)),duration:3}),n.fetchInvoice()):o.data&&o.data.error?n.$Message.error({content:o.data.error,duration:8}):n.$Message.error({content:n.$t("messages.fail"),duration:8});case 10:case"end":return r.stop()}}),r)})))()},exportPdf:function(t,e){var n="waiting_payment"===e?"export_pdf":"export_receipt_pdf",r=Object(d.a)(),o=this.$route.params.projectId,c="".concat("https://altitudeapp.altitude.co.th","/api/v1/download/projects/").concat(o,"/invoices/").concat(t,"/").concat(n,"?auth-token=").concat(r);window.open(c,"_blank")},buddhistDate:function(t){if(t){var e=t.split("/"),n=parseInt(e[0])+543;return"".concat(e[2],"/").concat(e[1],"/").concat(n)}return""}}},f=(n(609),n(9)),component=Object(f.a)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isLoading?n("GLoading"):n("div",[n("GBreadCrumb",{attrs:{names:[t.invoice.invoice_number]}}),t._v(" "),n("Card",{attrs:{bordered:!1,"dis-hover":""}},[n("div",{attrs:{slot:"title"},slot:"title"},[n("p",[t._v(t._s(t.$t("pages.invoice")))])]),t._v(" "),n("div",{staticClass:"extra-button mb-10"},[n("span",[n("Button",{staticClass:"button-orange",attrs:{size:"small"},nativeOn:{click:function(e){return t.$router.back()}}},[t._v("\n          "+t._s(t.$t("button.back"))+"\n        ")])],1),t._v(" "),n("span",[["waiting_payment"].includes(t.invoice.status)?n("Button",{staticClass:"button-green",attrs:{size:"small"},on:{click:function(e){return t.handleBeforeChange("pay",t.invoice.id)}}},[t._v("\n          "+t._s(t.$t("button.pay"))+"\n        ")]):t._e(),t._v(" "),["waiting_payment"].includes(t.invoice.status)?n("Button",{attrs:{size:"small",type:"error"},on:{click:function(e){return t.handleBeforeChange("cancel",t.invoice.id)}}},[t._v("\n          "+t._s(t.$t("button.cancel_invoice"))+"\n        ")]):t._e(),t._v(" "),["waiting_payment"].includes(t.invoice.status)?n("Button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.exportPdf(t.invoice.id,t.invoice.status)}}},[t._v("\n          "+t._s(t.$t("button.export_invoice"))+"\n        ")]):t._e(),t._v(" "),["paid"].includes(t.invoice.status)?n("Button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.exportPdf(t.invoice.id,t.invoice.status)}}},[t._v("\n          "+t._s(t.$t("button.export_receipt"))+"\n        ")]):t._e()],1)]),t._v(" "),n("Row",{attrs:{type:"flex",justify:"center"}},[n("Col",{attrs:{xs:24}},[n("div",{staticClass:"font-size-12 pa-0"},[n("div",{staticStyle:{float:"right"}},[n("span",{staticClass:"font-weight-bold font-size-14"},[t._v("\n              ใบแจ้งค่าใช้จ่าย/DEBIT NOTE\n            ")])]),t._v(" "),n("div",{staticClass:"div-container"},[n("table",{staticClass:"first-table"},[n("tbody",[n("tr",[n("td",{staticStyle:{width:"60%"}},[n("table",{staticClass:"table-company"},[n("tbody",[n("tr",[n("td",{attrs:{colspan:"2"}},[n("strong",[t._v(t._s(t.configuration.company_name))])])]),t._v(" "),n("tr",[n("td",[t._v(t._s(t.configuration.billing_address))])]),t._v(" "),n("tr",[n("td",{staticClass:"pb-10"},[t._v("\n                            โทร. "+t._s(t.configuration.telephone)+"\n                          ")])]),t._v(" "),n("tr",[n("td",[n("strong",[t._v("ชื่อ/Name : ")]),t._v("\n                            "+t._s(t.invoice.user?t.invoice.user.full_name_th:"")+"\n                          ")])]),t._v(" "),n("tr",[n("td",[n("strong",[t._v("ที่อยู่/Address : ")]),t._v("\n                            "+t._s(t.invoice.address)+"\n                            "+t._s(t.configuration.resident_address)+"\n                          ")])])])])]),t._v(" "),n("td",{staticClass:"font-size-12",staticStyle:{width:"40%"}},[n("table",{staticClass:"table-no"},[n("tbody",[n("tr",[n("td",[n("strong",[t._v("เลขที่/No.")])]),t._v(" "),n("td",{staticStyle:{width:"140px"}},[t._v("\n                            "+t._s(t.invoice.invoice_number)+"\n                          ")])]),t._v(" "),n("tr",[n("td",[n("strong",[t._v("วันที่/Date")])]),t._v(" "),n("td",[t._v("\n                            "+t._s(t.buddhistDate(t.invoice.created_at_invoice))+"\n                          ")])]),t._v(" "),n("tr",[n("td",[n("strong",[t._v("ประจำเดือน/Month")])]),t._v(" "),n("td",[t._v("\n                            "+t._s(t.invoice.period)+"\n                          ")])]),t._v(" "),n("tr",[n("td",[n("strong",[t._v("เลขห้อง/Room")])]),t._v(" "),n("td",[t._v("\n                            "+t._s(t.invoice.address)+"\n                          ")])]),t._v(" "),n("tr",[n("td",[n("strong",[t._v("สถานะ")])]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[n("GStatusLabelPreview",{attrs:{status:t.invoice.status}})],1)])])])])])])])]),t._v(" "),n("br"),n("br"),t._v(" "),n("div",{staticClass:"div-container"},[n("table",{staticClass:"table-list"},[n("thead",[n("tr",[n("th",{staticStyle:{width:"5%"}},[t._v("ลำดับ/No.")]),t._v(" "),n("th",{staticStyle:{width:"55%"}},[t._v("รายการ"),n("br"),t._v("Description")]),t._v(" "),n("th",{staticStyle:{width:"15%"}},[t._v("\n                    ราคา ต่อหน่วย (บาท)"),n("br"),t._v("Unit Price (THB)\n                  ")]),t._v(" "),n("th",{staticStyle:{width:"10%"}},[t._v("จำนวนหน่วย"),n("br"),t._v("Units")]),t._v(" "),n("th",{staticStyle:{width:"15%"}},[t._v("\n                    จำนวนเงิน (บาท)"),n("br"),t._v("Amount (THB)\n                  ")])])]),t._v(" "),n("tbody",[t._l(t.invoice.billings,(function(e,r){return n("tr",{key:e.id},[n("td",{staticClass:"text-center"},[t._v("\n                    "+t._s(r+1)+"\n                  ")]),t._v(" "),n("td",{staticClass:"text-left"},[t._v("\n                    "+t._s("other_billing"!==e.billing_type.key?e.billing_type.name_translations.th:"")+"\n                    "+t._s(e.billing_cycle||e.name)+"\n\n                    "),"water_billing"===e.billing_type.key?n("span",[t._v("\n                      "+t._s("["+e.previous_meter+"-"+e.current_meter+"]")+"\n                    ")]):"other_billing"===e.billing_type.key?n("span",[e.from_datetime_invoice===e.to_datetime_invoice?n("span",[t._v("\n                        ["+t._s(t.buddhistDate(e.to_datetime_invoice))+"]\n                      ")]):n("span",[t._v("\n                        "+t._s("["+t.buddhistDate(e.from_datetime_invoice)+" - "+t.buddhistDate(e.to_datetime_invoice)+"]")+"\n                      ")])]):t._e()]),t._v(" "),n("td",{staticClass:"text-right"},["actual"===e.payment_type?n("span",[t._v("\n                      "+t._s(e.actual_unit_price)+"\n                    ")]):n("span",[t._v("\n                      "+t._s(e.price_per_unit)+"\n                    ")])]),t._v(" "),n("td",{staticClass:"text-right"},[t._v("\n                    "+t._s(e.billing_cycle_month||parseInt(e.amount))+"\n                  ")]),t._v(" "),n("td",{staticClass:"text-right"},[t._v("\n                    "+t._s(e.total_price||"-")+"\n                  ")])])})),t._v(" "),n("tr",[n("td",{staticClass:"text-center",attrs:{colspan:"2"}},[t._v("\n                    "+t._s(t.billingAmount?"("+t.numberToThai(t.billingAmount)+")":"")+"\n                  ")]),t._v(" "),n("td",{staticClass:"text-right",attrs:{colspan:"2"}},[n("strong",[t._v("รวมเงินทั้งสิ้น/Grand Total")])]),t._v(" "),n("td",{staticClass:"text-right"},[n("strong",[t._v(t._s(t.convertPrice(t.billingAmount)))])])])],2)])]),t._v(" "),n("div",[t._v("\n            กำหนดชำระเงินภายในวันที่/Due Date:\n            "+t._s(t.buddhistDate(t.invoice.due_datetime_invoice))+"\n          ")]),t._v(" "),n("div",{staticStyle:{width:"50%"}},[t._v("หมายเหตุ/Remark: "+t._s(t.invoice.note))])])]),t._v(" "),n("Col",{attrs:{span:"24"}},[n("div",{staticClass:"font-size-12 pa-0",staticStyle:{float:"right"}},[n("span",{staticClass:"font-weight-bold"},[t._v("\n            "+t._s(t.$t("info.invoice.label.created_by"))+"\n          ")]),t._v(" "),n("span",[t._v("\n            "+t._s(" : "+t.invoice.created_by)+"\n          ")])])]),t._v(" "),"cancelled"==t.invoice.status||"paid"==t.invoice.status?n("Col",{attrs:{span:"24"}},[n("div",{staticClass:"font-size-12 pa-0",staticStyle:{float:"right"}},[n("span",{staticClass:"font-weight-bold"},[t._v("\n            "+t._s("cancelled"==t.invoice.status?t.$t("info.invoice.label.cancelled_by"):t.$t("info.invoice.label.received_by"))+"\n          ")]),t._v(" "),n("span",[t._v("\n            "+t._s(" : "+t.invoice.received_by)+"\n          ")])])]):t._e()],1)],1)],1)}),[],!1,null,"232643a4",null);e.default=component.exports}}]);