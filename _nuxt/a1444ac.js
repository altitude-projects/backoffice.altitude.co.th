(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{445:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(4),o=n(30),c=n(31),l=(n(25),n(6)),d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,e),this.json=t}var t,n,d;return Object(c.a)(e,null,[{key:"usersForSelect",value:(d=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.d)("get",Object(l.e)(l.a,"projects/".concat(t,"/assets/").concat(n,"/users_for_select")),{headers:Object(l.c)(!0),params:{search:r}});case 2:if(200!==(o=e.sent).status){e.next=5;break}return e.abrupt("return",o.data.users);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"assetsForSelect",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.d)("get",Object(l.e)(l.a,"projects/".concat(t,"/assets/assets_for_select")),{headers:Object(l.c)(!0),params:{search:r,user_id:n}});case 2:if(200!==(o=e.sent).status){e.next=5;break}return e.abrupt("return",o.data.assets);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"assetsForGenerateInvoice",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.d)("get",Object(l.e)(l.a,"projects/".concat(t,"/assets/assets_for_generate_invoice")),{headers:Object(l.c)(!0)});case 2:if(200!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n.data.assets);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}()},746:function(e,t,n){"use strict";n.r(t);var r=n(4),o=(n(25),n(83),n(54),n(108),n(11),n(1)),c=n.n(o),l=n(3),d=n(84),h=n(445),m=n(427),v={data:function(){return{isLoading:!0,loading:!0,invoices:[],unitFormModal:!1,generateAllInvoiceFormModal:!1,currentTab:null,tabs:["waiting_payment","paid","cancelled"],totalPages:null,currentPage:1,pageSize:10,datetime:[],statusCounts:[],search:"",assetsForGenerateInvoices:[]}},computed:{projectId:function(){return this.$route.params.projectId}},mounted:function(){this.$route.query.query_date?this.datetime=this.$route.query.query_date.split("_"):this.datetime=[c()().startOf("month").format("MM-DD-yyyy"),c()().endOf("month").format("MM-DD-yyyy")],this.setActiveTab(null,this.datetime),this.generateAllInvoice()},methods:{generateAllInvoice:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.assetsForGenerateInvoice(e.$route.params.projectId);case 2:e.assetsForGenerateInvoices=t.sent;case 3:case"end":return t.stop()}}),t)})))()},setActiveTab:function(e,t){e?this.currentTab=e:this.$route.hash?this.currentTab=this.$route.hash.replace("#",""):this.currentTab="waiting_payment",this.search="",this.fetchInvoices(t)},fetchInvoices:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.loading=!0,t.datetime=e||t.$route.query.query_date.split("_"),t.$router.push({query:{query_date:"".concat(t.datetime[0],"_").concat(t.datetime[1])},hash:"#".concat(t.currentTab)}),!t.currentTab||!t.datetime){n.next=10;break}return n.next=6,m.a.invoicesByStatus(t.projectId,t.currentTab,t.currentPage,t.pageSize,t.datetime,t.search);case 6:r=n.sent,t.invoices=Object(l.map)(r.invoices,(function(e,n){return e.json.no=n+1,e.asTableJson(t.pageSize,t.currentPage)})),t.totalPages=r.total_count,t.fetchInvoicesCountByStatus(t.datetime);case 10:t.isLoading=!1,t.loading=!1;case 12:case"end":return n.stop()}}),n)})))()},fetchInvoicesCountByStatus:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.a.invoicesCountByStatus(t.projectId,e);case 2:r=n.sent,t.statusCounts=r.data.invoices;case 4:case"end":return n.stop()}}),n)})))()},handleTabChange:function(e){this.setActiveTab(e)},reloadData:function(){this.generateAllInvoice(),this.fetchInvoices()},fetchItems:function(e,t){this.currentPage=e,this.pageSize=t,this.fetchInvoices()},searchItem:function(e){this.search=e,this.currentPage=1,this.fetchInvoices()},printInvoices:function(){var e=this;return new Promise((function(t){e.$Modal.confirm({title:e.$t("messages.confirm"),content:e.$t("messages.confirm_export_all_invoices"),okText:e.$t("button.yes"),cancelText:e.$t("button.no"),onOk:function(){var t=Object(d.a)(),n=c()(e.datetime).unix(),r="".concat("https://altitudeapp.altitude.co.th","/api/v1/download/projects/").concat(e.$route.params.projectId,"/invoices/export_invoices_pdf?auth-token=").concat(t,"&query_date=").concat(n);window.open(r,"_blank")}})}))}}},f=n(9),component=Object(f.a)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.isLoading?n("GLoading"):n("Card",{attrs:{"dis-hover":""}},[n("div",{attrs:{slot:"title"},slot:"title"},[n("h3",[e._v("\n        "+e._s(e.$t("pages.invoices"))+"\n      ")])]),e._v(" "),n("GDateRange",{attrs:{datetime:e.datetime},on:{fetchDateTime:e.fetchInvoices}}),e._v(" "),n("Tabs",{staticClass:"mt-10",attrs:{type:"card",animated:!1},on:{"on-click":e.handleTabChange},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}},e._l(e.tabs,(function(t,r){return n("TabPane",{key:t+r,attrs:{label:e.$t("status."+t)+" ("+(e.statusCounts[t]||0)+")",name:t}},[e.currentTab===t?n("GIndexPage",{attrs:{items:e.invoices,"show-sizer":"","search-by-api":"",loading:e.loading,"new-button-name":e.$t("pages.invoice"),component:"GInvoiceTable","generate-all-invoice":"","generate-all-invoice-items":e.assetsForGenerateInvoices,"date-month":"","extra-data":{tab:t},"current-page":e.currentPage,"page-size":e.pageSize,"total-pages":e.totalPages,"extra-button":e.$t("button.new")+e.$t("pages.invoice")},on:{handleExtraButton:function(t){e.unitFormModal=!0},reloadData:e.reloadData,pageAndItemPerPage:e.fetchItems,handleToSearchItem:e.searchItem,generateAllInvoice:function(t){e.generateAllInvoiceFormModal=!0},printInvoices:e.printInvoices}}):e._e()],1)})),1),e._v(" "),n("Modal",{attrs:{"footer-hide":"",closable:!1,"mask-closable":!1,width:"90%"},model:{value:e.unitFormModal,callback:function(t){e.unitFormModal=t},expression:"unitFormModal"}},[n("GInvoiceForm",{attrs:{"is-new":"","visible-modal":e.unitFormModal},on:{reloadData:e.reloadData,closeModal:function(t){e.unitFormModal=!1}}})],1),e._v(" "),n("Modal",{attrs:{"footer-hide":"",closable:!1,"mask-closable":!1,width:"90%"},model:{value:e.generateAllInvoiceFormModal,callback:function(t){e.generateAllInvoiceFormModal=t},expression:"generateAllInvoiceFormModal"}},[n("GGenerateAllInvoiceForm",{attrs:{title:e.$t("pages.generate_all_invoice"),items:e.assetsForGenerateInvoices},on:{reloadData:e.reloadData,closeModal:function(t){e.generateAllInvoiceFormModal=!1}}})],1)],1)],1)}),[],!1,null,"7934622d",null);t.default=component.exports}}]);