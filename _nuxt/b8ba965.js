(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{790:function(e,t,r){"use strict";r.r(t);var n=r(4),o=(r(48),r(42),r(41),r(11),r(25),r(3)),c=r(1),l=r.n(c),Y=r(427),d=r(82),m={props:{title:{type:String,default:function(){return""}},items:{type:Array,default:function(){return[]}}},data:function(){var e=this;return{formData:new Y.a,project:{},selectedAssets:[],condominiumColumns:[{type:"selection",key:"id",width:60,align:"center"},{key:"asset_number",width:150,renderHeader:function(t,r){return t("span","".concat(e.$t("form.unit.label.unit_number")))}},{key:"address_number",width:150,renderHeader:function(t,r){return t("span","".concat(e.$t("info.unit.label.address_number")))}},{key:"building",width:150,renderHeader:function(t,r){return t("span","".concat(e.$t("form.unit.label.building")))}},{key:"floor",width:150,renderHeader:function(t,r){return t("span","".concat(e.$t("form.unit.label.floor")))}},{slot:"billing_owner",width:150,renderHeader:function(t,r){return t("span","".concat(e.$t("form.unit.label.billing_owner")))}}],otherColumns:[{type:"selection",key:"id",width:60,align:"center"},{key:"address_number",width:150,renderHeader:function(t,r){return t("span","".concat(e.$t("form.unit.label.address_number")))}},{key:"asset_model",width:150,renderHeader:function(t,r){return t("span","".concat(e.$t("form.unit.label.asset_model")))}},{key:"model_type",slot:"model_type",width:150,renderHeader:function(t,r){return t("span","".concat(e.$t("form.unit.label.model_type")))}},{slot:"billing_owner",width:150,renderHeader:function(t,r){return t("span","".concat(e.$t("form.unit.label.billing_owner")))}}],rules:{due_datetime:[{required:!0,type:"date",message:this.$t("form.invoice.label.due_datetime")+" "+this.$t("error.cannot_be_blank"),trigger:"change,blur"}],period:[{required:!0,message:this.$t("form.invoice.label.period")+" "+this.$t("error.cannot_be_blank"),trigger:"change,blur"}]}}},computed:{months:function(){return[{en:"January ".concat(l()().format("YYYY")),th:"มกราคม ".concat(l()().format("YYYY")),value:"มกราคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"February ".concat(l()().format("YYYY")),th:"กุมภาพันธ์ ".concat(l()().format("YYYY")),value:"กุมภาพันธ์ ".concat(l()().add(543,"year").format("YYYY"))},{en:"March ".concat(l()().format("YYYY")),th:"มีนาคม ".concat(l()().format("YYYY")),value:"มีนาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"April ".concat(l()().format("YYYY")),th:"เมษายน ".concat(l()().format("YYYY")),value:"เมษายน ".concat(l()().add(543,"year").format("YYYY"))},{en:"May ".concat(l()().format("YYYY")),th:"พฤษภาคม ".concat(l()().format("YYYY")),value:"พฤษภาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"June ".concat(l()().format("YYYY")),th:"มิถุนายน ".concat(l()().format("YYYY")),value:"มิถุนายน ".concat(l()().add(543,"year").format("YYYY"))},{en:"July ".concat(l()().format("YYYY")),th:"กรกฏาคม ".concat(l()().format("YYYY")),value:"กรกฏาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"August ".concat(l()().format("YYYY")),th:"สิงหาคม ".concat(l()().format("YYYY")),value:"สิงหาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"September ".concat(l()().format("YYYY")),th:"กันยายน ".concat(l()().format("YYYY")),value:"กันยายน ".concat(l()().add(543,"year").format("YYYY"))},{en:"October ".concat(l()().format("YYYY")),th:"ตุลาคม ".concat(l()().format("YYYY")),value:"ตุลาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"November ".concat(l()().format("YYYY")),th:"พฤศจิกายน ".concat(l()().format("YYYY")),value:"พฤศจิกายน ".concat(l()().add(543,"year").format("YYYY"))},{en:"December ".concat(l()().format("YYYY")),th:"ธันวาคม ".concat(l()().format("YYYY")),value:"ธันวาคม ".concat(l()().add(543,"year").format("YYYY"))},{en:"January ".concat(l()().add(1,"year").format("YYYY")),th:"มกราคม ".concat(l()().add(1,"year").format("YYYY")),value:"มกราคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"February ".concat(l()().add(1,"year").format("YYYY")),th:"กุมภาพันธ์ ".concat(l()().add(1,"year").format("YYYY")),value:"กุมภาพันธ์ ".concat(l()().add(544,"year").format("YYYY"))},{en:"March ".concat(l()().add(1,"year").format("YYYY")),th:"มีนาคม ".concat(l()().add(1,"year").format("YYYY")),value:"มีนาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"April ".concat(l()().add(1,"year").format("YYYY")),th:"เมษายน ".concat(l()().add(1,"year").format("YYYY")),value:"เมษายน ".concat(l()().add(544,"year").format("YYYY"))},{en:"May ".concat(l()().add(1,"year").format("YYYY")),th:"พฤษภาคม ".concat(l()().add(1,"year").format("YYYY")),value:"พฤษภาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"June ".concat(l()().add(1,"year").format("YYYY")),th:"มิถุนายน ".concat(l()().add(1,"year").format("YYYY")),value:"มิถุนายน ".concat(l()().add(544,"year").format("YYYY"))},{en:"July ".concat(l()().add(1,"year").format("YYYY")),th:"กรกฏาคม ".concat(l()().add(1,"year").format("YYYY")),value:"กรกฏาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"August ".concat(l()().add(1,"year").format("YYYY")),th:"สิงหาคม ".concat(l()().add(1,"year").format("YYYY")),value:"สิงหาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"September ".concat(l()().add(1,"year").format("YYYY")),th:"กันยายน ".concat(l()().add(1,"year").format("YYYY")),value:"กันยายน ".concat(l()().add(544,"year").format("YYYY"))},{en:"October ".concat(l()().add(1,"year").format("YYYY")),th:"ตุลาคม ".concat(l()().add(1,"year").format("YYYY")),value:"ตุลาคม ".concat(l()().add(544,"year").format("YYYY"))},{en:"November ".concat(l()().add(1,"year").format("YYYY")),th:"พฤศจิกายน ".concat(l()().add(1,"year").format("YYYY")),value:"พฤศจิกายน ".concat(l()().add(544,"year").format("YYYY"))},{en:"December ".concat(l()().add(1,"year").format("YYYY")),th:"ธันวาคม ".concat(l()().add(1,"year").format("YYYY")),value:"ธันวาคม ".concat(l()().add(544,"year").format("YYYY"))}]}},watch:{items:function(e){e&&this.reformatData(this.items)}},mounted:function(){this.items&&this.reformatData(this.items),this.fetchProject()},methods:{fetchProject:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.a.show(e.$route.params.projectId);case 2:e.project=t.sent;case 3:case"end":return t.stop()}}),t)})))()},reformatData:function(e){this.formData.json.assets_params=e.map((function(e,i){var t=Object(o.find)(e.user_assets,["is_billing_owner",!0]);return{_checked:!1,id:e.id,user_id:t&&t.user_id?t.user_id:""}}))},handleSelectedUserAsset:function(data,e){this.formData.json.assets_params[e].user_id=data.value},rowSelections:function(e){var t=this;this.selectedAssets=e.map((function(e){return e.id})),this.formData.json.assets_params.forEach((function(e,r){if(t.selectedAssets.includes(e.id)){var param={_checked:!0,id:e.id,user_id:e.user_id};t.formData.json.assets_params[r]=param}else t.formData.json.assets_params[r]._checked=!1}))},handleClose:function(){this.$nextTick((function(){this.$refs.invoice.resetFields()})),this.$emit("closeModal")},handleSubmit:function(){var e=this;return new Promise((function(t){e.$Modal.confirm({title:e.$t("messages.are_you_sure"),content:e.$t("messages.confirm_save"),okText:e.$t("button.yes"),cancelText:e.$t("button.no"),onOk:function(){e.submitForm()}})}))},submitForm:function(){var e=this;this.$refs.invoice.validate(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=7;break}return t.next=3,e.formData.generateAllInvoice(e.$route.params.projectId);case 3:(n=t.sent).data&&n.data.success?(e.$Message.success({content:e.$t("pages.generate_all_invoice")+e.$t("messages.successfully_created"),duration:3}),e.handleClose(),e.$emit("reloadData")):e.$Message.error({content:e.$t("messages.fail"),duration:8}),e.handleClose(),e.$emit("reloadData");case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},f=r(9),component=Object(f.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.project&&e.project.json?r("Card",{attrs:{"dis-hover":"",bordered:!1}},[r("p",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.title))]),e._v(" "),r("Form",{ref:"invoice",attrs:{model:e.formData.json,"label-position":"top",rules:e.rules}},[r("Row",{attrs:{type:"flex",gutter:40}},[r("Col",{attrs:{span:"12"}},[r("FormItem",{attrs:{prop:"due_datetime",label:e.$t("form.invoice.label.due_datetime")}},[r("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:e.$t("form.invoice.placeholder.due_datetime")},model:{value:e.formData.json.due_datetime,callback:function(t){e.$set(e.formData.json,"due_datetime",t)},expression:"formData.json.due_datetime"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"12"}},[r("FormItem",{attrs:{prop:"period",label:e.$t("form.invoice.label.period")}},[r("Select",{attrs:{placeholder:e.$t("form.invoice.placeholder.period"),filterable:"",transfer:"",clearable:""},model:{value:e.formData.json.period,callback:function(t){e.$set(e.formData.json,"period",t)},expression:"formData.json.period"}},e._l(e.months,(function(t){return r("Option",{key:t.th,attrs:{value:t.value,label:t[e.$store.state.language.value]}},[e._v("\n              "+e._s(t[e.$store.state.language.value])+"\n            ")])})),1)],1)],1)],1),e._v(" "),r("FormItem",{attrs:{prop:"note",label:e.$t("form.invoice.label.note")}},[r("Input",{attrs:{maxlength:"500","show-word-limit":""},model:{value:e.formData.json.note,callback:function(t){e.$set(e.formData.json,"note",t)},expression:"formData.json.note"}})],1),e._v(" "),"condominium"===e.project.json.project_type?r("Table",{ref:"assetsForGenerateInvoice",attrs:{border:"",columns:e.condominiumColumns,data:e.items,"no-data-text":e.$t("pages.no_bill_data")},on:{"on-selection-change":e.rowSelections},scopedSlots:e._u([{key:"billing_owner",fn:function(t){var n=t.row,o=t.index;return[r("FormItem",{attrs:{prop:"assets_params["+o.toString()+"].user_id",rules:[{trigger:"submit",validator:function(t,r,n){e.formData.json.assets_params[o]._checked&&!e.formData.json.assets_params[o].user_id?n(e.$t("form.unit.label.billing_owner")+e.$t("error.cannot_be_blank")):n()}}]}},[r("Select",{attrs:{filterable:"",transfer:"",placeholder:e.$t("form.unit.placeholder.billing_owner")},on:{"on-select":function(data){return e.handleSelectedUserAsset(data,o)}},model:{value:e.formData.json.assets_params[o].user_id,callback:function(t){e.$set(e.formData.json.assets_params[o],"user_id",t)},expression:"formData.json.assets_params[index].user_id"}},e._l(n.user_assets,(function(t){return r("Option",{key:t.user_id,attrs:{value:t.user_id}},[e._v(e._s(t.user["full_name_"+e.$store.state.language.value]))])})),1)],1)]}}],null,!1,3487672571)}):r("Table",{ref:"assetsForGenerateInvoice",attrs:{border:"",columns:e.otherColumns,data:e.items,"no-data-text":e.$t("pages.no_bill_data")},on:{"on-selection-change":e.rowSelections},scopedSlots:e._u([{key:"model_type",fn:function(t){var r=t.row;return[e._v("\n        "+e._s(r.asset_type.name)+"\n      ")]}},{key:"billing_owner",fn:function(t){var n=t.row,o=t.index;return[r("FormItem",{attrs:{prop:"billing_owner",rules:{trigger:"submit,change",validator:function(t,r,n){e.formData.json.assets_params[o]._checked&&!e.formData.json.assets_params[o].user_id?n(e.$t("form.unit.label.billing_owner")+e.$t("error.cannot_be_blank")):n()}}}},[r("Select",{attrs:{filterable:"",transfer:"",placeholder:e.$t("form.unit.placeholder.billing_owner")},on:{"on-select":function(data){return e.handleSelectedUserAsset(data,o)}},model:{value:e.formData.json.assets_params[o].user_id,callback:function(t){e.$set(e.formData.json.assets_params[o],"user_id",t)},expression:"formData.json.assets_params[index].user_id"}},e._l(n.user_assets,(function(t){return r("Option",{key:t.user_id,attrs:{value:t.user_id}},[e._v(e._s(t.user["full_name_"+e.$store.state.language.value]))])})),1)],1)]}}],null,!1,3251205203)}),e._v(" "),r("FormItem",{attrs:{align:"center"}},[r("Button",{staticClass:"default-button button-grey",on:{click:function(t){return e.handleClose()}}},[e._v("\n        "+e._s(e.$t("button.cancel"))+"\n      ")]),e._v(" "),r("Button",{staticClass:"default-button button-green",attrs:{disabled:!(e.selectedAssets.length>0)},on:{click:function(t){return e.handleSubmit()}}},[e._v("\n        "+e._s(e.$t("button.submit"))+"\n      ")])],1)],1)],1):e._e()}),[],!1,null,null,null);t.default=component.exports}}]);