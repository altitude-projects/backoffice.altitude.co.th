(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{410:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r=n(4),l=n(30),c=n(31),o=(n(25),n(3)),_=n(6),d=n(5),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(l.a)(this,e),this.json=t}var t,n,m,y,h,f;return Object(c.a)(e,[{key:"save",value:(f=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,r=Object(d.e)(this.json,"unitType"),!this.json.id){e.next=8;break}return e.next=5,Object(_.d)("patch",Object(_.e)(_.a,"projects/".concat(t,"/asset_types/").concat(this.json.id)),{headers:Object(_.c)(!0),data:r});case 5:n=e.sent,e.next=11;break;case 8:return e.next=10,Object(_.d)("post",Object(_.e)(_.a,"projects/".concat(t,"/asset_types")),{headers:Object(_.c)(!0),data:r});case 10:n=e.sent;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"activate",value:(h=Object(r.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.d)("patch",Object(_.e)(_.a,"projects/".concat(t,"/asset_types/").concat(this.json.id,"/activate")),{headers:Object(_.c)(!0)});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"inactivate",value:(y=Object(r.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.d)("patch",Object(_.e)(_.a,"projects/".concat(t,"/asset_types/").concat(this.json.id,"/inactivate")),{headers:Object(_.c)(!0)});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})}],[{key:"unitTypeForSelect",value:(m=Object(r.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.d)("get",Object(_.e)(_.a,"projects/".concat(t,"/asset_types/asset_types_for_select")),{headers:Object(_.c)(!0)});case 2:if(200!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n.data.asset_types);case 5:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"index",value:(n=Object(r.a)(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(_.d)("get",Object(_.e)(_.a,"projects/".concat(n,"/asset_types")),{headers:Object(_.c)(!0)});case 2:if(200!==(r=t.sent).status){t.next=5;break}return t.abrupt("return",Object(o.map)(r.data.asset_types,(function(t,n){return t.no=n+1,new e(t,n)})));case 5:return t.abrupt("return",[]);case 6:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Object(r.a)(regeneratorRuntime.mark((function t(n,r){var l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(_.d)("get",Object(_.e)(_.a,"projects/".concat(n,"/asset_types/").concat(r)),{headers:Object(_.c)(!0)});case 2:if(200!==(l=t.sent).status){t.next=5;break}return t.abrupt("return",new e(l.data.asset_type));case 5:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})}]),e}()},419:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));n(21),n(15),n(18),n(32),n(33);var r=n(4),l=n(7),c=n(30),o=n(31),_=(n(16),n(25),n(3)),d=n(1),m=n.n(d),y=n(6),h=n(5);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function j(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,e),this.json=j(j({},t),{},{extra_detail_json:t.extra_detail_json||{price_per_unit:"",payment_calculation_by:"",asset_types:{}}}),this.json.extra_detail_json.price_per_unit=Object(h.m)(this.json.extra_detail_json.price_per_unit)}var t,n,l,d;return Object(o.a)(e,[{key:"generateBilling",value:(d=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(y.d)("patch",Object(y.e)(y.a,"projects/".concat(t,"/billing_cycles/").concat(n,"/generate_billing")),{data:{billing_cycle_id:n},headers:Object(y.c)(!0)});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})},{key:"save",value:(l=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,(r=Object(_.cloneDeep)(this.json)).from_date=m()(this.json.from_date).format("YYYY-MM-DD"),r.to_date=m()(this.json.to_date).format("YYYY-MM-DD"),!this.json.id){e.next=10;break}return e.next=7,Object(y.d)("patch",Object(y.e)(y.a,"projects/".concat(t,"/billing_cycles/").concat(this.json.id)),{data:{billing_cycle:r},headers:Object(y.c)(!0)});case 7:n=e.sent,e.next=13;break;case 10:return e.next=12,Object(y.d)("post",Object(y.e)(y.a,"projects/".concat(t,"/billing_cycles")),{data:{billing_cycle:r},headers:Object(y.c)(!0)});case 12:n=e.sent;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"asTableJson",value:function(){return{id:this.json.id,name:this.json.name,project_id:this.json.project_id,to_date:this.json.to_date,from_date:this.json.from_date,month:this.json.month,extra_detail_json:this.json.extra_detail_json,price_per_unit:Object(h.c)(this.json.extra_detail_json.price_per_unit)||0}}}],[{key:"index",value:(n=Object(r.a)(regeneratorRuntime.mark((function t(n,r){var l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(y.d)("get",Object(y.e)(y.a,"projects/".concat(n,"/billing_cycles")),{params:{type:r},headers:Object(y.c)(!0)});case 2:if(200!==(l=t.sent).status){t.next=5;break}return t.abrupt("return",Object(_.map)(l.data.billing_cycles,(function(t){return new e(t)})));case 5:return t.abrupt("return",[]);case 6:case"end":return t.stop()}}),t)}))),function(e,t){return n.apply(this,arguments)})},{key:"billingCycleTypes",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(y.d)("get",Object(y.e)(y.a,"projects/".concat(t,"/billing_cycles/billing_cycle_types")),{headers:Object(y.c)(!0)});case 2:if(200!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",n.data.data);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}()},752:function(e,t,n){"use strict";n.r(t);var r=n(4),l=(n(25),n(16),n(11),n(3)),c=n(419),o=n(410),_=n(82),d={data:function(){return{unitTypes:[],isLoading:!1,billingCycle:new c.a,billingCycleModal:!1,ruleInline:{name:[{required:!0,message:this.$t("form.bill_cycle.label.name")+this.$t("error.cannot_be_blank"),trigger:"change,blur"}],month:[{required:!0,type:"number",message:this.$t("form.bill_cycle.label.month")+this.$t("error.cannot_be_blank"),trigger:"change,blur"}],from_date:[{type:"date",required:!0,message:this.$t("form.bill_cycle.label.start_datetime")+this.$t("error.cannot_be_blank"),trigger:"change,blur"}],to_date:[{type:"date",required:!0,message:this.$t("form.bill_cycle.label.end_datetime")+this.$t("error.cannot_be_blank"),trigger:"change,blur"}]},loading:!1,isNew:!1,title:"",type:"",billingcycles:[],projectType:""}},computed:{language:function(){return this.$store.state.language.value},titleModal:function(){return(this.isNew?this.$t("button.new"):this.$t("button.edit"))+this.$t("pages.billing_cycle")}},watch:{language:function(){this.$nextTick((function(){this.$refs.form&&(this.ruleInline.name[0].message=this.$t("form.bill_cycle.label.name")+this.$t("error.cannot_be_blank"),this.ruleInline.month[0].message=this.$t("form.bill_cycle.label.month")+this.$t("error.cannot_be_blank"),this.ruleInline.from_date[0].message=this.$t("form.bill_cycle.label.start_datetime")+this.$t("error.cannot_be_blank"),this.ruleInline.to_date[0].message=this.$t("form.bill_cycle.label.end_datetime")+this.$t("error.cannot_be_blank"))}))},billingCycleModal:function(e,t){e||this.$refs.form.resetFields()}},mounted:function(){this.fetchProjectType(),this.fetchUnitTypes(),this.getTitle(),this.fetchBillingCycles()},methods:{convertPrice:n(5).c,checkTitle:function(text){return this.$t(text)},fetchProjectType:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_.a.show(e.$route.params.projectId);case 2:n=t.sent,e.projectType=n.json.project_type;case 4:case"end":return t.stop()}}),t)})))()},fetchUnitTypes:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,o.a.index(e.$route.params.projectId);case 3:n=t.sent,e.unitTypes=Object(l.map)(n,(function(u){return u.json})),e.isLoading=!1;case 6:case"end":return t.stop()}}),t)})))()},handleClose:function(){this.$refs.form.resetFields(),this.billingCycleModal=!1},modalBillingCycle:function(){this.billingCycle=new c.a,"maintenance_fee"===this.$route.params.billingTypeId&&(this.billingCycle.json.extra_detail_json.payment_calculation_by="actual"),this.billingCycleModal=!0,this.isNew=!0},getTitle:function(){switch(this.$route.params.billingTypeId){case"water_billing":this.title="pages.water_billing",this.type="WaterBillingCycle";break;case"maintenance_fee":this.title="pages.maintenance_billing",this.type="MaintenanceBillingCycle";break;default:this.title="pages.other_billing",this.type="OtherBillingCycle"}},editBillingCycle:function(data){this.billingCycle=Object(l.cloneDeep)(new c.a(data)),this.billingCycle.json.from_date=new Date(this.billingCycle.json.from_date),this.billingCycle.json.to_date=new Date(this.billingCycle.json.to_date),this.billingCycleModal=!0,this.isNew=!1},fetchBillingCycles:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.next=3,c.a.index(t.$route.params.projectId,t.type);case 3:n=e.sent,t.billingcycles=Object(l.map)(n,(function(e){return e.asTableJson()})),t.isLoading=!1;case 6:case"end":return e.stop()}}),e)})))()},handleSubmit:function(){var e=this;return new Promise((function(t){e.$Modal.confirm({title:e.$t("messages.are_you_sure"),content:e.$t("messages.confirm_save"),okText:e.$t("button.yes"),cancelText:e.$t("button.no"),onOk:function(){e.submitForm()}})}))},submitForm:function(){var e=this;switch(this.$route.params.billingTypeId){case"water_billing":this.billingCycle.json.type="WaterBillingCycle";break;case"maintenance_fee":this.billingCycle.json.type="MaintenanceBillingCycle";break;default:this.billingCycle.json.type="OtherBillingCycle"}this.$refs.form.validate(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=5;break}return t.next=3,e.billingCycle.save(e.$route.params.projectId);case 3:(r=t.sent).data&&r.data.success?(e.$Message.success({content:e.$t("pages.billing_cycle")+e.$t("messages.successfully_updated"),duration:3}),e.handleClose(),e.fetchBillingCycles()):"Validation failed: To date must be after from date."===r.data.error?e.$Message.error({content:"".concat(e.$t("form.bill_cycle.label.end_datetime")," ").concat(e.$t("error.cannot_less_than")," ").concat(e.$t("form.bill_cycle.label.start_datetime")),duration:8}):(c=Object(l.snakeCase)(r.data.error),e.$Message.error({content:e.$t("messages.".concat(c)),duration:8}));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},m=n(9),component=Object(m.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isLoading?n("GLoading"):n("div",[n("GBreadCrumb"),e._v(" "),n("GIndexPage",{attrs:{items:e.billingcycles,"show-sizer":"",title:e.checkTitle(e.title),loading:e.loading,"new-button-name":e.$t("pages.billing_cycle"),component:"GBillingCycleTable","button-action-billng-cycle":""},on:{billingCycle:e.modalBillingCycle,extraFunctionWithObject:e.editBillingCycle,reloadData:e.fetchBillingCycles}}),e._v(" "),n("Modal",{attrs:{"footer-hide":"",title:e.titleModal,closable:!1,"mask-closable":!1},model:{value:e.billingCycleModal,callback:function(t){e.billingCycleModal=t},expression:"billingCycleModal"}},[n("Form",{ref:"form",attrs:{model:e.billingCycle.json,rules:e.ruleInline,"label-position":"top","hide-footer":""}},[n("Row",[n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"name",label:e.$t("form.bill_cycle.label.name")}},[n("Input",{attrs:{type:"text",placeholder:e.$t("form.bill_cycle.placeholder.name")},model:{value:e.billingCycle.json.name,callback:function(t){e.$set(e.billingCycle.json,"name",t)},expression:"billingCycle.json.name"}})],1)],1),e._v(" "),n("Row",{attrs:{type:"flex",justify:"space-between"}},[n("Col",{staticClass:"mr-5",attrs:{span:11}},[n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"from_date",label:e.$t("form.bill_cycle.label.start_datetime")}},[n("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",format:"dd/MM/yyyy",placeholder:e.$t("form.bill_cycle.placeholder.start_datetime")},model:{value:e.billingCycle.json.from_date,callback:function(t){e.$set(e.billingCycle.json,"from_date",t)},expression:"billingCycle.json.from_date"}})],1)],1),e._v(" "),n("Col",{attrs:{span:11}},[n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"to_date",label:e.$t("form.bill_cycle.label.end_datetime")}},[n("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",format:"dd/MM/yyyy",placeholder:e.$t("form.bill_cycle.placeholder.end_datetime")},model:{value:e.billingCycle.json.to_date,callback:function(t){e.$set(e.billingCycle.json,"to_date",t)},expression:"billingCycle.json.to_date"}})],1)],1)],1),e._v(" "),"maintenance_fee"===e.$route.params.billingTypeId?n("Row",[n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"month",label:e.$t("form.billing_type.label.month")}},[n("Input",{attrs:{number:"",type:"number",placeholder:e.$t("form.billing_type.placeholder.month")},model:{value:e.billingCycle.json.month,callback:function(t){e.$set(e.billingCycle.json,"month",t)},expression:"billingCycle.json.month"}})],1),e._v(" "),"actual"===e.billingCycle.json.extra_detail_json.payment_calculation_by?n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"extra_detail_json.price_per_unit",rules:{required:!0,message:"condominium"===e.projectType?e.$t("form.billing_type.label.condominium_price_per_unit")+" "+e.$t("error.cannot_be_blank"):e.$t("form.billing_type.label.other_price_per_unit")+" "+e.$t("error.cannot_be_blank"),trigger:"change,blur"},label:"condominium"===e.projectType?e.$t("form.billing_type.label.condominium_price_per_unit"):e.$t("form.billing_type.label.other_price_per_unit")}},[n("Input",{attrs:{type:"number",placeholder:e.$t("form.billing_type.placeholder.price_per_unit")},model:{value:e.billingCycle.json.extra_detail_json.price_per_unit,callback:function(t){e.$set(e.billingCycle.json.extra_detail_json,"price_per_unit",t)},expression:"billingCycle.json.extra_detail_json.price_per_unit"}})],1):"asset_type"===e.billingCycle.json.extra_detail_json.payment_calculation_by?e._l(e.unitTypes,(function(t,r){return n("span",{key:r},[n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"extra_detail_json.asset_types."+t.id,rules:{required:!0,type:"number",message:"condominium"===e.projectType?e.$t("form.billing_type.label.condominium_price_per_unit")+" "+e.$t("error.cannot_be_blank"):e.$t("form.billing_type.label.other_price_per_unit")+" "+e.$t("error.cannot_be_blank"),trigger:"change,blur"},label:"condominium"===e.projectType?e.$t("form.billing_type.label.condominium_price_per_unit"):e.$t("form.billing_type.label.other_price_per_unit")}},[n("Input",{staticClass:"my-5",attrs:{type:"number",placeholder:e.$t("form.billing_type.placeholder.price_per_unit")},model:{value:e.billingCycle.json.extra_detail_json.asset_types[t.id],callback:function(n){e.$set(e.billingCycle.json.extra_detail_json.asset_types,t.id,n)},expression:"\n                billingCycle.json.extra_detail_json.asset_types[unitType.id]\n              "}},[n("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v(e._s(t.name))])])],1)],1)})):e._e()],2):e._e(),e._v(" "),"water_billing"===e.$route.params.billingTypeId?n("Row",[n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"extra_detail_json.price_per_unit",label:e.$t("form.bill_cycle.label.price_per_unit"),rules:{required:!0,message:e.$t("form.bill_cycle.label.price_per_unit")+e.$t("error.cannot_be_blank"),trigger:"change,blur"}}},[n("Input",{attrs:{type:"number",placeholder:"00.00"},model:{value:e.billingCycle.json.extra_detail_json.price_per_unit,callback:function(t){e.$set(e.billingCycle.json.extra_detail_json,"price_per_unit",t)},expression:"billingCycle.json.extra_detail_json.price_per_unit"}})],1)],1):e._e(),e._v(" "),n("Row",{attrs:{type:"flex",justify:"center"}},[n("Button",{staticClass:"default-button button-grey",on:{click:function(t){return e.handleClose()}}},[e._v("\n          "+e._s(e.$t("button.cancel"))+"\n        ")]),e._v(" "),n("Button",{staticClass:"default-button button-green",on:{click:e.handleSubmit}},[e._v("\n          "+e._s(e.$t("button.save")))])],1)],1)],1)],1)}),[],!1,null,"347927d9",null);t.default=component.exports}}]);