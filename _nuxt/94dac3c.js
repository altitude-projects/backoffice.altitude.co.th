(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{420:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var r=n(4),o=n(30),c=n(31),l=(n(25),n(3)),m=n(6),d=n(5),f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,t),this.json=e,this.json.name_translations=e.name_translations||{en:"",th:""},this.json.description_translations=e.description_translations||{en:"",th:""},this.json.brand_translations=e.brand_translations||{en:"",th:""}}var e,n,f,h,_;return Object(c.a)(t,[{key:"save",value:(_=Object(r.a)(regeneratorRuntime.mark((function t(e,n){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null,o=Object(d.e)(this.json,"assetSupply"),o=Object(d.n)(o,"asset_supply",["image"]),!this.json.id){t.next=9;break}return t.next=6,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(e,"/assets/").concat(n,"/asset_supplies/").concat(this.json.id)),{data:o,headers:Object(m.c)(!0)});case 6:r=t.sent,t.next=12;break;case 9:return t.next=11,Object(m.d)("post",Object(m.e)(m.a,"projects/".concat(e,"/assets/").concat(n,"/asset_supplies")),{data:o,headers:Object(m.c)(!0)});case 11:r=t.sent;case 12:return t.abrupt("return",r);case 13:case"end":return t.stop()}}),t,this)}))),function(t,e){return _.apply(this,arguments)})},{key:"activate",value:(h=Object(r.a)(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(e,"/assets/").concat(n,"/asset_supplies/").concat(this.json.id,"/activate")),{headers:Object(m.c)(!0)});case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return h.apply(this,arguments)})},{key:"inactivate",value:(f=Object(r.a)(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(e,"/assets/").concat(n,"/asset_supplies/").concat(this.json.id,"/inactivate")),{headers:Object(m.c)(!0)});case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return f.apply(this,arguments)})},{key:"asTableJson",value:function(){return{id:this.json.id,name_translations:this.json.name_translations||"-",supply_category:this.json.supply_category,description_translations:this.json.description_translations||"-",setup_datetime:this.json.setup_datetime?Object(d.g)(this.json.setup_datetime):"-",warranty_expired_datetime:this.json.warranty_expired_datetime?Object(d.g)(this.json.warranty_expired_datetime):"-",last_maintenance:this.json.maintenance_datetime?Object(d.g)(this.json.maintenance_datetime):"-",status:this.json.status||"-"}}}],[{key:"index",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("get",Object(m.e)(m.a,"projects/".concat(n,"/assets/").concat(r,"/asset_supplies")),{headers:Object(m.c)(!0)});case 2:if(200!==(o=e.sent).status){e.next=5;break}return e.abrupt("return",Object(l.map)(o.data.asset_supplies,(function(e,n){return new t(e)})));case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(t,e){return n.apply(this,arguments)})},{key:"show",value:(e=Object(r.a)(regeneratorRuntime.mark((function e(n,r,o){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("get",Object(m.e)(m.a,"projects/".concat(n,"/assets/").concat(r,"/asset_supplies/").concat(o)),{headers:Object(m.c)(!0)});case 2:if(200!==(c=e.sent).status){e.next=5;break}return e.abrupt("return",new t(c.data.asset_supply));case 5:return e.abrupt("return",c);case 6:case"end":return e.stop()}}),e)}))),function(t,n,r){return e.apply(this,arguments)})}]),t}()},786:function(t,e,n){"use strict";n.r(e);n(21),n(15),n(18),n(32),n(33);var r=n(7),o=n(4),c=(n(11),n(25),n(420));function l(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function m(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var d={props:{isNew:{type:Boolean,default:!1}},data:function(){var t=this;return{formData:new c.a,roles:[],deviceTypes:[{en:"Electric device",th:"เครื่องใช้ไฟฟ้า",value:"electric_device"},{en:"Furniture",th:"เฟอร์นิเจอร์",value:"furniture"},{en:"Sanitary ware",th:"สุขภัณฑ์",value:"sanitary_ware"}],rules:{supply_category:[{required:!0,message:this.$t("form.device.label.type")+" "+this.$t("error.cannot_be_blank"),trigger:"blur,change"}],"name_translations.th":[{required:!0,message:this.$t("form.device.label.name")+" "+this.$t("error.cannot_be_blank"),trigger:"blur,change"}],"name_translations.en":[{required:!0,message:this.$t("form.device.label.name")+" "+this.$t("error.cannot_be_blank"),trigger:"blur,change"}],setup_datetime:[{trigger:"blur",type:"date",validator:function(e,n,r){n&&n<t.formData.json.setup_datetime?r(t.$t("messages.invalid_end_date")):r()}}]}}},computed:{backUrl:function(){return{name:"projects-projectId-units-unitId-show",params:{projectId:this.$route.params.projectId,unitId:this.$route.params.unitId},query:{tab:"devices"}}},language:function(){return this.$store.state.language.value}},watch:{language:function(){this.$nextTick((function(){this.$refs.form&&(this.rules.supply_category[0].message=this.$t("form.device.label.type")+" "+this.$t("error.cannot_be_blank"),this.rules["name_translations.th"][0].message=this.$t("form.device.label.name")+this.$t("error.cannot_be_blank"),this.rules["name_translations.en"][0].message=this.$t("form.device.label.name")+this.$t("error.cannot_be_blank"),this.rules.setup_datetime[0].message=this.$t("messages.invalid_end_date"),this.togleValidation())}))}},mounted:function(){this.isNew||this.fetchDevice()},methods:{togleValidation:function(){var t=this;this.$refs.form.validate((function(e){""!==t.formData.json.name_translations.en||""!==t.formData.json.description_translations.en?(t.formData.json.name_translations.th=t.formData.json.name_translations.en,t.formData.json.description_translations.th=t.formData.json.description_translations.en):(t.formData.json.name_translations.en=t.formData.json.name_translations.th,t.formData.json.description_translations.en=t.formData.json.description_translations.th)}))},fetchDevice:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.a.show(t.$route.params.projectId,t.$route.params.unitId,t.$route.params.deviceId);case 2:t.formData=e.sent,t.formData.json.setup_datetime&&(t.formData.json.setup_datetime=new Date(t.formData.json.setup_datetime)),t.formData.json.warranty_expired_datetime&&(t.formData.json.warranty_expired_datetime=new Date(t.formData.json.warranty_expired_datetime)),t.formData.json.maintenance_datetime&&(t.formData.json.maintenance_datetime=new Date(t.formData.json.maintenance_datetime));case 6:case"end":return e.stop()}}),e)})))()},updateFormData:function(t){this.formData.json=m(m({},this.formData.json),t)},handleSubmit:function(){var t=this;return new Promise((function(e){t.$Modal.confirm({title:t.$t("messages.confirm"),content:t.$t("messages.confirm_save"),okText:t.$t("button.yes"),cancelText:t.$t("button.no"),onOk:function(){t.submitForm()}})}))},checkTranslation:function(){"en"===this.language?(this.formData.json.name_translations.th=this.formData.json.name_translations.en,this.formData.json.description_translations.th=this.formData.json.description_translations.en):(this.formData.json.name_translations.en=this.formData.json.name_translations.th,this.formData.json.description_translations.en=this.formData.json.description_translations.th)},submitForm:function(){var t=this;this.$refs.form.validate(function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=6;break}return t.checkTranslation(),e.next=4,t.formData.save(t.$route.params.projectId,t.$route.params.unitId);case 4:(r=e.sent).data&&r.data.success?(t.isNew?t.$Message.success({content:t.$t("pages.device")+t.$t("messages.successfully_created"),duration:3}):t.$Message.success({content:t.$t("pages.device")+t.$t("messages.successfully_updated"),duration:3}),t.$router.push(t.backUrl)):r.data&&r.data.error?t.$Message.error({content:r.data.error,duration:8}):t.$Message.error({content:t.$t("messages.fail"),duration:8});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}},f=n(9),component=Object(f.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Card",{attrs:{"dis-hover":"",bordered:!1}},[n("p",{attrs:{slot:"title"},slot:"title"},[t._v("\n      "+t._s(t.isNew?t.$t("button.new"):t.$t("button.edit"))+t._s(t.$t("pages.device"))+"\n    ")]),t._v(" "),n("Card",{attrs:{"dis-hover":"",bordered:!1}},[n("Row",{attrs:{type:"flex",justify:"center"}},[n("Col",{attrs:{xs:24,sm:13}},[n("Form",{ref:"form",attrs:{rules:t.rules,model:t.formData.json}},[n("Row",{attrs:{type:"flex",justify:"center"}},[n("Col",[n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"image"}},[n("GUpload",{attrs:{"field-key":"image"},on:{updateParentValue:t.updateFormData},model:{value:t.formData.json.image,callback:function(e){t.$set(t.formData.json,"image",e)},expression:"formData.json.image"}})],1)],1)],1),t._v(" "),n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"supply_category",label:t.$t("form.device.label.type")}},[n("Select",{attrs:{placeholder:t.$t("form.device.placeholder.type")},model:{value:t.formData.json.supply_category,callback:function(e){t.$set(t.formData.json,"supply_category",e)},expression:"formData.json.supply_category"}},t._l(t.deviceTypes,(function(e){return n("Option",{key:e.value,attrs:{value:e.value}},[t._v("\n                  "+t._s(e[t.language])+"\n                ")])})),1)],1),t._v(" "),n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"name_translations."+t.language,label:t.$t("form.device.label.name")}},[n("Input",{attrs:{type:"text",placeholder:t.$t("form.device.placeholder.name")},model:{value:t.formData.json.name_translations[t.language],callback:function(e){t.$set(t.formData.json.name_translations,t.language,e)},expression:"formData.json.name_translations[language]"}})],1),t._v(" "),n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"description_translations["+t.language+"]",label:t.$t("form.device.label.details")}},[n("Input",{attrs:{type:"text",placeholder:t.$t("form.device.placeholder.details")},model:{value:t.formData.json.description_translations[t.language],callback:function(e){t.$set(t.formData.json.description_translations,t.language,e)},expression:"formData.json.description_translations[language]"}})],1),t._v(" "),n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"setup_datetime",label:t.$t("form.device.label.start_date")}},[n("DatePicker",{staticStyle:{width:"100%"},attrs:{format:"dd/MM/yyyy",type:"date",placeholder:t.$t("form.device.placeholder.start_date")},model:{value:t.formData.json.setup_datetime,callback:function(e){t.$set(t.formData.json,"setup_datetime",e)},expression:"formData.json.setup_datetime"}})],1),t._v(" "),n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"warranty_expired_datetime",label:t.$t("form.device.label.end_date")}},[n("DatePicker",{staticStyle:{width:"100%"},attrs:{format:"dd/MM/yyyy",type:"date",placeholder:t.$t("form.device.placeholder.end_date")},model:{value:t.formData.json.warranty_expired_datetime,callback:function(e){t.$set(t.formData.json,"warranty_expired_datetime",e)},expression:"formData.json.warranty_expired_datetime"}})],1),t._v(" "),n("FormItem",{staticClass:"font-weight-bold",attrs:{prop:"last_maintenance",label:t.$t("form.device.label.last_maintenance")}},[n("DatePicker",{staticStyle:{width:"100%"},attrs:{format:"dd/MM/yyyy",type:"date",placeholder:t.$t("form.device.placeholder.last_maintenance")},model:{value:t.formData.json.maintenance_datetime,callback:function(e){t.$set(t.formData.json,"maintenance_datetime",e)},expression:"formData.json.maintenance_datetime"}})],1),t._v(" "),n("FormItem",{attrs:{align:"center"}},[n("Button",{staticClass:"default-button button-grey",attrs:{to:t.backUrl}},[t._v("\n                "+t._s(t.$t("button.cancel"))+"\n              ")]),t._v(" "),n("Button",{staticClass:"default-button button-green",on:{click:t.handleSubmit}},[t._v("\n                "+t._s(t.$t("button.save"))+"\n              ")])],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,"3986d78a",null);e.default=component.exports}}]);