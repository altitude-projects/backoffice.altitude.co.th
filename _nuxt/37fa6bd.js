(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{406:function(t,e,r){"use strict";r.d(e,"a",(function(){return j}));r(15),r(18),r(32),r(33);var n=r(4),o=r(7),c=r(30),l=r(31),f=(r(21),r(25),r(3)),m=r(6),d=r(5);function _(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function h(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?_(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):_(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,t),this.json=h(h({},e),{},{first_name_translations:e.first_name_translations||{en:"",th:""},last_name_translations:e.last_name_translations||{en:"",th:""},title_translations:e.title_translations||{en:"",th:""}})}var e,r,o,_,j,y,v;return Object(l.a)(t,[{key:"resetPassword",value:(v=Object(n.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.d)("patch",Object(m.e)(m.b,"reset_password"),{data:{user:this.json},headers:Object(m.c)(!0)});case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),t,this)}))),function(){return v.apply(this,arguments)})},{key:"forgetPassword",value:(y=Object(n.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.d)("patch",Object(m.e)(m.b,"forgot_password"),{data:{user:this.json},headers:Object(m.c)(!0)});case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),t,this)}))),function(){return y.apply(this,arguments)})},{key:"save",value:(j=Object(n.a)(regeneratorRuntime.mark((function t(e){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null,(n=Object(d.e)(this.json,"user")).juristic_person="yes"===n.juristic_person,o=Object(d.n)({user:n,addresses:e},null,["profile_image"]),!this.json.id){t.next=10;break}return t.next=7,Object(m.d)("patch",Object(m.e)(m.a,"users/".concat(this.json.id)),{headers:Object(m.c)(!0),data:o});case 7:r=t.sent,t.next=13;break;case 10:return t.next=12,Object(m.d)("post",Object(m.e)(m.a,"users"),{headers:Object(m.c)(!0),data:o});case 12:r=t.sent;case 13:return t.abrupt("return",r);case 14:case"end":return t.stop()}}),t,this)}))),function(t){return j.apply(this,arguments)})},{key:"asInfoJson",value:function(){return{addresses:this.json.addresses,no:this.json.no,customer_code:this.json.customer_code||"-",customer_type:this.json.customer_type||"-",date_of_birth:this.json.date_of_birth?Object(d.g)(this.json.date_of_birth):"-",display_name:this.json.display_name?this.json.display_name:"-",email:this.json.email||"-",facebook:this.json.facebook||"-",full_name:this.fullName(),gender:this.json.gender,id:this.json.id,issue_at:this.json.issue_at||"-",juristic_person:this.json.juristic_person,language:this.json.language||"-",line:this.json.line||"-",marital_status:this.json.marital_status,mobile_primary:this.json.mobile_primary||"-",mobile_secondary:this.json.mobile_secondary||"-",nationality:Object(f.startCase)(this.json.nationality),passport_country:this.json.passport_country||"-",passport_number:this.json.passport_number||"-",profile_image:this.json.profile_image||null,race:Object(f.startCase)(this.json.race),telephone_oversea:this.json.telephone_oversea||"-",telephone:this.json.telephone||"-",thai_id_number:this.json.thai_id_number||"-",user_assets:this.json.user_assets,wechat:this.json.wechat||"-",whatsapp:this.json.whatsapp||"-"}}},{key:"fullName",value:function(){var t=[],e=[];return this.json.first_name_translations&&Object.keys(this.json.first_name_translations).length>0&&(t.push(this.json.first_name_translations.th),e.push(this.json.first_name_translations.en)),this.json.last_name_translations&&Object.keys(this.json.last_name_translations).length>0&&(t.push(this.json.last_name_translations.th),e.push(this.json.last_name_translations.en)),{th:t.join(" "),en:e.join(" ")}}}],[{key:"index",value:(_=Object(n.a)(regeneratorRuntime.mark((function e(r,n,o,c){var l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("get",Object(m.e)(m.a,"projects/".concat(r,"/user_assets")),{params:{page:n,per_page:o,search:c},headers:Object(m.c)(!0)});case 2:if(200!==(l=e.sent).status){e.next=6;break}return d=Object(f.map)(l.data.users,(function(e){return new t(e)})),e.abrupt("return",{users:d,total_count:l.data.total_count});case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)}))),function(t,e,r,n){return _.apply(this,arguments)})},{key:"show",value:(o=Object(n.a)(regeneratorRuntime.mark((function e(r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("get",Object(m.e)(m.a,"users/".concat(r)),{headers:Object(m.c)(!0)});case 2:if(200!==(n=e.sent).status){e.next=5;break}return e.abrupt("return",new t(n.data.user));case 5:case"end":return e.stop()}}),e)}))),function(t){return o.apply(this,arguments)})},{key:"destroy",value:(r=Object(n.a)(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.d)("delete",Object(m.e)(m.a,"users/".concat(e)),{headers:Object(m.c)(!0)});case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)}))),function(t){return r.apply(this,arguments)})},{key:"importUserAssets",value:(e=Object(n.a)(regeneratorRuntime.mark((function t(e,r){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new FormData).append("file",r),t.next=4,Object(m.d)("post",Object(m.e)(m.a,"projects/".concat(e,"/assets/import_user_assets")),{headers:Object(m.c)(!0,!0),data:n});case 4:return o=t.sent,t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)}))),function(t,r){return e.apply(this,arguments)})}]),t}()},446:function(t,e,r){"use strict";r.d(e,"a",(function(){return j}));r(21),r(15),r(18),r(32),r(33);var n=r(4),o=r(7),c=r(30),l=r(31),f=(r(25),r(3)),m=r(6),d=r(5);function _(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function h(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?_(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):_(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,t),this.json=h(h({},e),{},{facility_id:"",number_of_user:""})}var e,r,o;return Object(l.a)(t,[{key:"save",value:(o=Object(n.a)(regeneratorRuntime.mark((function t(e,r){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null,o=Object(d.e)(this.json,"facilityBooking"),!this.json.id){t.next=8;break}return t.next=5,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(e,"/facilities/").concat(r,"/facility_bookings/").concat(this.json.id)),{data:{facility_booking:o},headers:Object(m.c)(!0)});case 5:n=t.sent,t.next=11;break;case 8:return t.next=10,Object(m.d)("post",Object(m.e)(m.a,"projects/".concat(e,"/facilities/").concat(r,"/facility_bookings")),{data:{facility_booking:o},headers:Object(m.c)(!0)});case 10:n=t.sent;case 11:return t.abrupt("return",n);case 12:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"cancel",value:(r=Object(n.a)(regeneratorRuntime.mark((function t(e,r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(e,"/facilities/").concat(r,"/facility_bookings/").concat(this.json.id,"/cancel")),{headers:Object(m.c)(!0)});case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})}],[{key:"index",value:(e=Object(n.a)(regeneratorRuntime.mark((function e(r,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("get",Object(m.e)(m.a,"projects/".concat(r,"/facilities/").concat(n,"/facility_bookings")),{headers:Object(m.c)(!0)});case 2:if(200!==(o=e.sent).status){e.next=5;break}return e.abrupt("return",Object(f.map)(o.data.facility_bookings,(function(e){return new t(e)})));case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(t,r){return e.apply(this,arguments)})}]),t}()},519:function(t,e,r){var content=r(640);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(23).default)("3e3ec61a",content,!0,{sourceMap:!1})},639:function(t,e,r){"use strict";r(519)},640:function(t,e,r){var n=r(22)(!1);n.push([t.i,"[data-v-3ee5aab6] .loading-style{margin:0}.loading-custom[data-v-3ee5aab6]{height:468px;padding-top:40%}",""]),t.exports=n},788:function(t,e,r){"use strict";r.r(e);var n=r(4),o=(r(25),r(303),r(11),r(83),r(18),r(42),r(41),r(3)),c=r(1),l=r.n(c),f=r(5),m=r(446),d=r(406),_={props:{defaultDate:{type:Date,default:function(){return new Date}},editFacilityBooking:{type:Object,default:function(){return{}}},facilities:{type:Array,default:function(){return[]}},visibleModal:{type:Boolean,default:function(){return!1}}},data:function(){return{dateOption:{disabledDate:function(t){return t&&t.valueOf()<Date.now()-864e5}},disabledForm:!1,isLoading:!1,formData:new m.a,limits:[],display:"block",residents:[],isSearching:!1,filteredResidents:[]}},computed:{language:function(){return this.$store.state.language.value},activeFacilities:function(){return Object(o.filter)(this.facilities,{status:"active"})}},watch:{editFacilityBooking:function(t){this.fetchResidents(t),this.disabledForm=!0},defaultDate:function(t,e){this.formData.json.date=this.defaultDate},visibleModal:function(){this.resetAllFields()}},mounted:function(){this.fetchResidents()},methods:{fetchResidents:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,d.a.index(e.$route.params.projectId);case 2:n=r.sent,e.residents=Object(o.map)(n.users,(function(t){var e=[t.json.full_name_th,t.json.full_name_en];return t.json.name_for_select=Object(o.join)(e," / "),t.json})),t&&(e.formData.json.id=t.id,e.formData.json.facility_id=t.facility_id,e.formData.json.user_id=t.user_id,e.formData.json.from_time=new Date(t.start_datetime),e.formData.json.to_time=new Date(t.end_datetime),e.formData.json.number_of_user=t.number_of_user,e.limits=Number(t.maximum_limit));case 5:case"end":return r.stop()}}),r)})))()},setFacility:function(data){var t=Object(o.find)(this.facilities,{id:data});t&&(this.limits=Number(t.maximum_limit))},handleClose:function(){this.resetAllFields(),this.disabledForm=!1,this.$emit("closeModal")},resetAllFields:function(){this.formData=new m.a,this.formData.json.date=this.defaultDate},handleSubmit:function(){var t=this;return new Promise((function(e){t.$Modal.confirm({title:t.$t("messages.confirm_save"),okText:t.$t("button.yes"),cancelText:t.$t("button.no"),onOk:function(){t.submitForm()}})}))},submitForm:function(){var t=this;this.$refs.form.validate(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(r,n){var c,m,d,_,h,j;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=12;break}return t.$emit("closeModal"),t.isLoading=!0,t.display="none",t.formData.json.date&&(c=Object(f.g)(t.formData.json.date,"YYYY/MM/DD"),m=Object(o.toString)(l()(c+" "+t.formData.json.from_time).unix()),d=Object(o.toString)(l()(c+" "+t.formData.json.to_time).unix()),t.formData.json.start_datetime=m,t.formData.json.end_datetime=d),e.next=7,t.formData.save(t.$route.params.projectId,t.formData.json.facility_id);case 7:(_=e.sent).data&&_.data.success?t.$Message.success({content:t.$t("messages.success"),duration:3}):_.data.error?((h=_.data.error)&&(2===(j=h.split(" ")).length&&"full"===j[0]?h="".concat(t.$t("messages.schedule_is_full")," ").concat(j[1]):3===j.length&&(h="".concat(t.$t("messages.only")," ").concat(j[1]," ").concat(t.$t("messages.user_available")," ").concat(j[2]))),t.$Message.error({content:h,duration:8})):t.$Message.error({content:t.$t("messages.fail"),duration:8}),t.handleClose(),t.isLoading=!1,t.display="block";case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())},filterResident:function(t){var e=this;""===t||this.disabledForm?this.filteredResidents=this.residents:(this.isSearching=!0,this.filteredResidents=this.residents,setTimeout((function(){e.isSearching=!1,e.filteredResidents=e.residents.filter((function(e){return e.full_name_en.toLowerCase().includes(t.toLowerCase())||e.full_name_th.includes(t)}))}),200))}}},h=(r(639),r(9)),component=Object(h.a)(_,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.isLoading?r("GLoading",{staticClass:"loading-custom"}):r("div",{style:{display:t.display}},[r("Card",{attrs:{bordered:!1,"dis-hover":"",padding:20}},[r("p",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.$t("pages.booking")))]),t._v(" "),r("Form",{ref:"form",attrs:{"label-position":"top","label-colon":"",model:t.formData.json}},[r("FormItem",{attrs:{prop:"facility_id",label:t.$t("form.facility_booking.label.facility_id"),rules:[{required:!0,message:t.$t("form.facility_booking.label.facility_id")+" "+t.$t("error.cannot_be_blank"),trigger:"blur,change"}]}},[r("Select",{attrs:{disabled:t.disabledForm,placeholder:t.$t("form.facility_booking.placeholder.facility_id")},on:{"on-change":t.setFacility},model:{value:t.formData.json.facility_id,callback:function(e){t.$set(t.formData.json,"facility_id",e)},expression:"formData.json.facility_id"}},t._l(t.activeFacilities,(function(e){return r("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name_translations[t.language]))])})),1)],1),t._v(" "),r("FormItem",{attrs:{prop:"resident",label:t.$t("form.facility_booking.label.select_resident")}},[r("Select",{ref:"selectResident",attrs:{disabled:t.disabledForm,filterable:"",clearable:"",loading:t.isSearching,"remote-method":t.filterResident,placeholder:t.$t("form.facility_booking.placeholder.select_resident")},model:{value:t.formData.json.user_id,callback:function(e){t.$set(t.formData.json,"user_id",e)},expression:"formData.json.user_id"}},t._l(t.filteredResidents,(function(e,i){return r("Option",{key:i,attrs:{value:e.id,label:e.name_for_select}},[r("span",[t._v("\n              "+t._s("en"===t.language?e.full_name_en:e.full_name_th)+"\n            ")]),t._v(" "),r("Row",[r("Col",{staticClass:"white-space-normal",attrs:{span:"24"}},[r("p",{staticStyle:{color:"#c6c4c4"}},[t._v("\n                  "+t._s("en"!==t.language?e.full_name_en:e.full_name_th)+"\n                ")])])],1),t._v(" "),r("Row",[r("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[r("p",{staticStyle:{color:"#c6c4c4"}},[t._v("\n                  "+t._s(e.thai_id_number?e.thai_id_number:e.passport_number)+"\n                ")])]),t._v(" "),r("Col",{staticClass:"white-space-normal",attrs:{span:"12"}},[r("p",{staticStyle:{color:"#c6c4c4"}},[t._v("\n                  "+t._s(e.telephone)+"\n                ")])])],1)],1)})),1)],1),t._v(" "),r("FormItem",{attrs:{prop:"date",label:t.$t("form.facility_booking.label.date"),rules:[{required:!0,type:"date",message:t.$t("form.facility_booking.label.date")+" "+t.$t("error.cannot_be_blank"),trigger:"blur,change"}]}},[r("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",format:"dd/MM/yyyy",options:t.dateOption,placeholder:t.$t("form.facility_booking.placeholder.date")},model:{value:t.formData.json.date,callback:function(e){t.$set(t.formData.json,"date",e)},expression:"formData.json.date"}})],1),t._v(" "),r("Row",{attrs:{gutter:10}},[r("Col",{attrs:{span:12}},[r("FormItem",{attrs:{prop:"from_time",label:t.$t("form.facility_booking.label.from_time"),rules:[{required:!0,message:t.$t("form.facility_booking.label.from_time")+" "+t.$t("error.cannot_be_blank"),trigger:"blur,change"},{required:!0,trigger:"blur,change",validator:function(e,r,n){r>=t.formData.json.to_time?n(t.$t("form.facility_booking.label.from_time")+" "+t.$t("error.less_than")+" "+t.$t("form.facility_booking.label.to_time")):(t.$refs.form.fields[4].validateState="",n())}}]}},[r("TimePicker",{staticStyle:{width:"100%"},attrs:{type:"time",format:"HH:mm",steps:[1,30],placeholder:t.$t("form.facility_booking.placeholder.from_time")},model:{value:t.formData.json.from_time,callback:function(e){t.$set(t.formData.json,"from_time",e)},expression:"formData.json.from_time"}})],1)],1),t._v(" "),r("Col",{attrs:{span:12}},[r("FormItem",{attrs:{prop:"to_time",label:t.$t("form.facility_booking.label.to_time"),rules:[{required:!0,message:t.$t("form.facility_booking.label.to_time")+" "+t.$t("error.cannot_be_blank"),trigger:"blur,change"},{required:!0,trigger:"blur,change",validator:function(e,r,n){r<=t.formData.json.from_time?n(t.$t("form.facility_booking.label.to_time")+" "+t.$t("error.more_than")+" "+t.$t("form.facility_booking.label.from_time")):(t.$refs.form.fields[3].validateState="",n())}}]}},[r("TimePicker",{staticStyle:{width:"100%"},attrs:{type:"time",format:"HH:mm",steps:[1,30],placeholder:t.$t("form.facility_booking.placeholder.to_time")},model:{value:t.formData.json.to_time,callback:function(e){t.$set(t.formData.json,"to_time",e)},expression:"formData.json.to_time"}})],1)],1)],1),t._v(" "),r("FormItem",{attrs:{prop:"number_of_user",label:t.$t("form.facility_booking.label.number_of_user"),rules:[{required:!0,type:"number",message:t.$t("form.facility_booking.label.number_of_user")+" "+t.$t("error.cannot_be_blank"),trigger:"blur,change"}]}},[r("Select",{attrs:{disabled:!t.formData.json.facility_id,placeholder:t.$t("form.facility_booking.placeholder.number_of_user")},model:{value:t.formData.json.number_of_user,callback:function(e){t.$set(t.formData.json,"number_of_user",e)},expression:"formData.json.number_of_user"}},t._l(t.limits,(function(e){return r("Option",{key:e,attrs:{value:e}},[t._v(t._s(e)+" ")])})),1)],1),t._v(" "),r("FormItem",{staticClass:"text-center"},[r("Button",{staticClass:"default-button button-grey",on:{click:function(e){return t.handleClose()}}},[t._v("\n          "+t._s(t.$t("button.cancel"))+"\n        ")]),t._v(" "),r("Button",{staticClass:"default-button",attrs:{type:"success"},on:{click:function(e){return t.handleSubmit()}}},[t._v("\n          "+t._s(t.$t("button.save"))+"\n        ")])],1)],1)],1)],1)}),[],!1,null,"3ee5aab6",null);e.default=component.exports}}]);