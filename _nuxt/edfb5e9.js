(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{434:function(t,e,n){var content=n(463);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(23).default)("5a4c433c",content,!0,{sourceMap:!1})},462:function(t,e,n){"use strict";n(434)},463:function(t,e,n){var r=n(22)(!1);r.push([t.i,"[data-v-6b4d75d2] .ivu-card-bordered{border:0!important}[data-v-6b4d75d2] .ivu-table-cell{padding-left:0;padding-right:0;text-overflow:ellipsis;white-space:normal}",""]),t.exports=r},553:function(t,e,n){"use strict";n.r(e);var r=n(4),c=(n(25),n(34),n(11),n(3)),o=n(426),d=n(448),l={props:{items:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!0}},data:function(){var t=this;return{incidentAction:new d.a,columns:[{key:"no",width:80,align:"center",renderHeader:function(e,n){return e("span","".concat(t.$t("info.incident.label.no")))}},{slot:"title",width:150,renderHeader:function(e,n){return e("span","".concat(t.$t("info.incident.label.title")))}},{slot:"name",width:130,align:"center",renderHeader:function(e,n){return e("span","".concat(t.$t("info.incident.label.incident_type")))}},{slot:"created_by",width:150,align:"left",renderHeader:function(e,n){return e("span","".concat(t.$t("info.incident.label.created_by")))}},{key:"due_date",width:150,align:"center",renderHeader:function(e,n){return e("span","".concat(t.$t("info.incident.label.due_datetime")))}},{key:"created_at",width:150,renderHeader:function(e,n){return e("span","".concat(t.$t("info.incident.label.created_at")))}},{key:"updated_at",width:150,renderHeader:function(e,n){return e("span","".concat(t.$t("info.incident.label.updated_at")))}},{slot:"status",width:160,align:"center",renderHeader:function(e,n){return e("span","".concat(t.$t("info.incident.label.status")))}},{slot:"action",align:"center",width:120,renderHeader:function(e,n){return e("span","".concat(t.$t("info.incident.label.action")))}}]}},computed:{language:function(){return this.$store.state.language.value},projectId:function(){return this.$route.params.projectId},currentTabColumns:function(){var t=Object(c.cloneDeep)(this.columns);return Object(c.includes)(["#completed","#cancelled"],this.$route.hash)?t.slice(0,7):t}},mounted:function(){},methods:{checkTitle:function(title){return Object(c.isObject)(title)?title[this.language]:title||"-"},handleBeforeChange:function(t,e){var n=this;return new Promise((function(r){n.$Modal.confirm({title:n.$t("pages.confirm"),content:n.$t("messages.are_you_sure"),okText:n.$t("button.yes"),cancelText:n.$t("button.no"),onOk:function(){n.changeStatus(t,e)}})}))},changeStatus:function(t,e){var n=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("cancel"!==t){r.next=6;break}return r.next=3,o.a.cancel(n.projectId,e);case 3:c=r.sent,r.next=15;break;case 6:if("close"!==t){r.next=12;break}return r.next=9,o.a.complete(n.projectId,e);case 9:c=r.sent,r.next=15;break;case 12:return r.next=14,o.a.submit(n.projectId,e);case 14:c=r.sent;case 15:200===c.status?(n.$Message.success({content:n.$t("messages.successfully_edited"),duration:3}),n.autoCommentChangeStatus(t,e),n.$emit("reloadData",t)):n.$Message.error({content:n.$t("messages.fail"),duration:8});case 16:case"end":return r.stop()}}),r)})))()},autoCommentChangeStatus:function(t,e){"submit"===t?(this.incidentAction.json.description=this.$t("form.incident.status_change_to"),this.submitComment(t,e)):"reject"===t?(this.incidentAction.json.description=this.$t("form.incident.status_cancelled"),this.submitComment(t,e)):(this.incidentAction.json.description=this.$t("form.incident.status_complete"),this.submitComment(t,e))},submitComment:function(t,e){var n=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.incidentAction.save(n.projectId,e);case 2:t.sent.data.success||n.$Message.error({conetnt:n.$t("messages.fail"),duration:8});case 4:case"end":return t.stop()}}),t)})))()}}},f=(n(462),n(9)),component=Object(f.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Table",{attrs:{columns:t.currentTabColumns,data:t.items,loading:t.loading,"no-data-text":t.$t("pages.no_data")},scopedSlots:t._u([{key:"name",fn:function(e){var n=e.row;return[t._v("\n    "+t._s(n.name[t.language])+"\n  ")]}},{key:"created_by",fn:function(e){var r=e.row;return["Admin"===r.incidentable_type?n("div",[t._v("\n      "+t._s(r.incidentable.full_name)+"\n    ")]):n("div",[t._v("\n      "+t._s(r.incidentable["full_name_"+t.language]+" ("+t.$t("info.incident.label.role_resident")+")")+"\n    ")])]}},{key:"title",fn:function(e){var r=e.row;return[n("nuxt-link",{attrs:{to:{name:"projects-projectId-incidents-incidentId-show",params:{projectId:t.$route.params.projectId,incidentId:r.id}}}},[t._v("\n      "+t._s(t.checkTitle(r.title))+"\n    ")])]}},{key:"status",fn:function(t){var e=t.row;return[n("GStatusLabelPreview",{attrs:{status:e.status}})]}},{key:"action",fn:function(e){var r=e.row;return[n("Row",{attrs:{type:"flex",justify:"center"}},[n("Col",["opened"===r.status||"pending_approval"===r.status?n("Tooltip",{attrs:{transfer:"",content:t.$t("button.complete"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{size:"24",type:"md-checkmark-circle"},on:{click:function(e){return t.handleBeforeChange("close",r.id)}}})],1):t._e()],1),t._v(" "),n("Col",["opened"===r.status&&"User"===r.incidentable_type?n("Tooltip",{attrs:{transfer:"",content:t.$t("button.submit_to_reporter"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{size:"24",type:"ios-arrow-dropright-circle"},on:{click:function(e){return t.handleBeforeChange("submit",r.id)}}})],1):t._e()],1),t._v(" "),n("Col",["opened"===r.status||"pending_approval"===r.status?n("Tooltip",{attrs:{transfer:"",content:t.$t("button.cancel"),placement:"top"}},[n("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"md-close-circle",size:"24"},on:{click:function(e){return t.handleBeforeChange("cancel",r.id)}}})],1):t._e()],1)],1)]}}])})}),[],!1,null,"6b4d75d2",null);e.default=component.exports}}]);