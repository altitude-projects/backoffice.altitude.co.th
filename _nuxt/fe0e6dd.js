(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{408:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));n(21),n(15),n(18),n(32),n(33);var r=n(4),o=n(7),c=n(30),l=n(31),m=(n(303),n(16),n(25),n(3)),f=n(1),d=n.n(f),_=n(6),h=n(5);function j(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function y(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,e),this.json=y(y({},t),{},{price_per_unit:t.price_per_unit?Object(h.m)(t.price_per_unit):""})}var t,n,o,f,j,v,O,x,k,w,D;return Object(l.a)(e,[{key:"save",value:(D=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,o=Object(h.e)(this.json,"otherBilling"),!this.json.id){e.next=8;break}return e.next=5,Object(_.d)("patch",Object(_.e)(_.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/")),{data:o,headers:Object(_.c)(!0)});case 5:r=e.sent,e.next=11;break;case 8:return e.next=10,Object(_.d)("post",Object(_.e)(_.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/")),{data:o,headers:Object(_.c)(!0)});case 10:r=e.sent;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"generateWaterBill",value:(w=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null,(c=Object(m.cloneDeep)(this.json)).billing_cycle=this.json.billing_cycle?d()(this.json.billing_cycle).unix():null,c.due_datetime=this.json.due_datetime?d()(this.json.due_datetime).unix():null,c.price_per_unit=this.json.price_per_unit?Number(this.json.price_per_unit):null,c.from_datetime=this.json.from_datetime?d()(this.json.from_datetime).unix():null,c.to_datetime=this.json.to_datetime?d()(this.json.to_datetime).unix():null,c=Object(m.pickBy)(c,m.isNil),e.next=10,Object(_.d)("post",Object(_.e)(_.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/generate_asset_billings")),{data:y({billing:c},r),headers:Object(_.c)(!0)});case 10:return o=e.sent,e.abrupt("return",o);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return w.apply(this,arguments)})},{key:"update",value:(k=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(h.e)(this.json,"billing"),e.next=3,Object(_.d)("patch",Object(_.e)(_.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/").concat(this.json.id)),{data:{billing:r},headers:Object(_.c)(!0)});case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"asTableJson",value:function(){return{asset:this.json.asset,asset_id:this.json.asset_id,address_number:this.json.asset?this.json.asset.address_number:"",asset_number:this.json.asset?this.json.asset.asset_number:"",building:this.json.asset?this.json.asset.building:"",floor:this.json.asset?this.json.asset.floor:"",usable_area:this.json.asset?Object(h.m)(this.json.asset.usable_area):"",area_for_maintenance_fee_calculation:this.json.asset?Object(h.m)(this.json.asset.area_for_maintenance_fee_calculation):"",asset_type:this.json.asset&&this.json.asset.asset_type?this.json.asset.asset_type.name:"",asset_model:this.json.asset&&this.json.asset.asset_model?this.json.asset.asset_model:"-",billing_cycle_month:this.json.billing_cycle?this.json.billing_cycle.month:"",actual_unit_price:this.json.asset?Object(h.c)(Object(h.m)(this.json.asset.area_for_maintenance_fee_calculation)*Object(h.m)(this.json.price_per_unit)):"",area:this.json.asset?Object(h.m)(this.json.asset.area):"",amount:this.json.amount?Object(h.c)(this.json.amount):"-",name:this.json.name,no:this.json.no,billing_cycle:this.json.billing_cycle?this.json.billing_cycle.name:null,billing_type_id:this.json.billing_type_id,created_at:this.json.created_at,from_datetime:Object(h.g)(this.json.from_datetime),from_datetime_invoice:Object(h.g)(this.json.from_datetime,"YYYY/MM/DD"),id:this.json.id,price_per_unit:this.json.price_per_unit?Object(h.c)(this.json.price_per_unit):"-",status:this.json.status,to_datetime:Object(h.g)(this.json.to_datetime),to_datetime_invoice:Object(h.g)(this.json.to_datetime,"YYYY/MM/DD"),total_price:Object(h.c)(this.json.total_price)||"-",unit:this.json.unit,payment_type:this.json.billing_cycle?this.json.billing_cycle.extra_detail_json.payment_calculation_by:"",previous_meter:Object(m.isNil)(this.json.previous_meter)?"-":this.json.previous_meter,current_meter:Object(m.isNil)(this.json.current_meter)?"-":this.json.current_meter,billing_type:this.json.billing_type,billing_owner:this.json.have_owner}}}],[{key:"typesIndex",value:(x=Object(r.a)(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(_.d)("get",Object(_.e)(_.a,"projects/".concat(n,"/billing_types")),{headers:Object(_.c)(!0)});case 2:if(200!==(r=t.sent).status){t.next=5;break}return t.abrupt("return",Object(m.map)(r.data.billing_types,(function(t){return new e(t)})));case 5:return t.abrupt("return",[]);case 6:case"end":return t.stop()}}),t)}))),function(e){return x.apply(this,arguments)})},{key:"index",value:(O=Object(r.a)(regeneratorRuntime.mark((function t(n,r,o){var c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(_.d)("get",Object(_.e)(_.a,"projects/".concat(n,"/billing_types/").concat(r,"/billings/")),{params:{billing_cycle_name:o},headers:Object(_.c)(!0)});case 2:if(200!==(c=t.sent).status){t.next=5;break}return t.abrupt("return",Object(m.map)(c.data.billings,(function(t,n){return t.no=n+1,new e(t)})));case 5:return t.abrupt("return",[]);case 6:case"end":return t.stop()}}),t)}))),function(e,t,n){return O.apply(this,arguments)})},{key:"billingsByStatus",value:(v=Object(r.a)(regeneratorRuntime.mark((function t(n,r,o,c,l,f,d,h){var j,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(_.d)("get",Object(_.e)(_.a,"projects/".concat(n,"/billing_types/").concat(r,"/billings/billings_by_status")),{params:{billing_cycle_name:o,status:c,query_date:l,page:f,per_page:d,search:h},headers:Object(_.c)(!0)});case 2:if(200!==(j=t.sent).status){t.next=6;break}return y=Object(m.map)(j.data.billings,(function(t){return new e(t)})),t.abrupt("return",{billings:y,total_count:j.data.total_count});case 6:return t.abrupt("return",[]);case 7:case"end":return t.stop()}}),t)}))),function(e,t,n,r,o,c,l,m){return v.apply(this,arguments)})},{key:"billingsCountByStatus",value:(j=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r,o){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.d)("get",Object(_.e)(_.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/billings_count_by_status")),{params:{billing_cycle_name:r,query_date:o},headers:Object(_.c)(!0)});case 2:if(200!==(c=e.sent).status){e.next=5;break}return e.abrupt("return",c.data.billings);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return j.apply(this,arguments)})},{key:"updateBillings",value:(f=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.d)("patch",Object(_.e)(_.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/update_billings")),{data:{billings:r},headers:Object(_.c)(!0)});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"cancel",value:(o=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.d)("patch",Object(_.e)(_.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/").concat(r,"/cancel")),{headers:Object(_.c)(!0)});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"finalize",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.d)("patch",Object(_.e)(_.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/").concat(r,"/finalize")),{headers:Object(_.c)(!0)});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"finalizeBillings",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.d)("patch",Object(_.e)(_.a,"projects/".concat(t,"/billing_types/").concat(n,"/billings/finalize_billings")),{params:{billing_ids:r},headers:Object(_.c)(!0)});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}()},409:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));n(21),n(15),n(18),n(32),n(33);var r=n(4),o=n(7),c=n(30),l=n(31),m=(n(16),n(25),n(3)),f=n(6),d=n(5);function _(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function h(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?_(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):_(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,e),this.json=h(h({},t),{},{area:t.area||0})}var t,n,o,_,j,y,v;return Object(l.a)(e,[{key:"save",value:(v=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,r=Object(d.e)(this.json,"unit"),!this.json.id){e.next=8;break}return e.next=5,Object(f.d)("patch",Object(f.e)(f.a,"projects/".concat(t,"/assets/").concat(this.json.id)),{headers:Object(f.c)(!0),data:r});case 5:n=e.sent,e.next=11;break;case 8:return e.next=10,Object(f.d)("post",Object(f.e)(f.a,"projects/".concat(t,"/assets")),{headers:Object(f.c)(!0),data:r});case 10:n=e.sent;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"asTableJson",value:function(e,t){return{id:this.json.id,no:(t-1)*e+this.json.no,address_number:this.json.address_number||"-",asset_number:this.json.asset_number||"-",asset_model:this.json.asset_model||"-",asset_type_name:this.json.asset_type.name,building:this.json.building||"-",usable_area:this.json.usable_area||"-",area:this.json.area||"-",phase:this.json.phase||"-",floor:this.json.floor||"-",property_type:this.json.property_type||"-"}}}],[{key:"index",value:(y=Object(r.a)(regeneratorRuntime.mark((function t(n,r,o,c){var l,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.d)("get",Object(f.e)(f.a,"projects/".concat(n,"/assets")),{headers:Object(f.c)(!0),params:{search:r,page:o,per_page:c}});case 2:if(l=t.sent,d=Object(m.orderBy)(l.data.assets,["address_number"],["asc"]),200!==l.status){t.next=7;break}return d=Object(m.map)(d,(function(t,n){return t.no=n+1,new e(t)})),t.abrupt("return",{units:d,total_count:l.data.total_count});case 7:return t.abrupt("return",[]);case 8:case"end":return t.stop()}}),t)}))),function(e,t,n,r){return y.apply(this,arguments)})},{key:"show",value:(j=Object(r.a)(regeneratorRuntime.mark((function t(n,r){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.d)("get",Object(f.e)(f.a,"projects/".concat(n,"/assets/").concat(r)),{headers:Object(f.c)(!0)});case 2:if(200!==(o=t.sent).status){t.next=5;break}return t.abrupt("return",new e(o.data.asset));case 5:case"end":return t.stop()}}),t)}))),function(e,t){return j.apply(this,arguments)})},{key:"destroy",value:(_=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("delete",Object(f.e)(f.a,"projects/".concat(t,"/assets/").concat(n)),{headers:Object(f.c)(!0)});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return _.apply(this,arguments)})},{key:"assetBillings",value:(o=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("get",Object(f.e)(f.a,"projects/".concat(t,"/assets/").concat(n,"/asset_billings")),{headers:Object(f.c)(!0)});case 2:if(200!==(r=e.sent).status){e.next=5;break}return e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"importAssets",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("file",n),e.next=4,Object(f.d)("post",Object(f.e)(f.a,"projects/".concat(t,"/assets/import_assets")),{headers:Object(f.c)(!0,!0),data:r});case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"importAssetSupplies",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new FormData).append("file",n),o.append("images_zip_file",r),e.next=5,Object(f.d)("post",Object(f.e)(f.a,"projects/".concat(t,"/assets/import_asset_supplies")),{headers:Object(f.c)(!0,!0),data:o});case 5:return c=e.sent,e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}()},541:function(e,t,n){var content=n(690);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(23).default)("29d64db2",content,!0,{sourceMap:!1})},689:function(e,t,n){"use strict";n(541)},690:function(e,t,n){var r=n(22)(!1);r.push([e.i,"img[data-v-03876564]{width:18px;height:18px}[data-v-03876564] .ivu-form-item{margin-bottom:0}",""]),e.exports=r},824:function(e,t,n){"use strict";n.r(t);var r=n(4),o=(n(25),n(303),n(16),n(11),n(3)),c=n(408),l=n(5),m=n(409),f={filters:{paymentType:function(data){if(data){return Object(o.find)([{label:"Pay as Actual",value:"actual"},{label:"Pay as Unit Type",value:"asset_type"}],["value",data]).label}}},props:{billingTypeKey:{type:String,default:null},projectType:{type:String,default:null},items:{type:Array,default:function(){return[]}}},data:function(){var e=this;return{isLoading:!0,formData:{billings:[]},units:[],billingTable:{water_billing:"billingColumns",maintenance_fee:"maintenanceColumns",other_billing:"otherBillingColumns"},columns:[],billingColumns:[{key:"asset_number",width:100,renderHeader:function(t,n){return t("span","".concat(e.$t("info.unit.label.asset_number")))}},{key:"address_number",width:100,sortable:!0,renderHeader:function(t,n){return t("span","".concat(Object(o.includes)(["condominium"],e.projectType)?e.$t("info.unit.label.address_number"):e.$t("info.billing.label.house_number")))}},{key:"building",width:100,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.building")))}},{slot:"previous_meter",width:100,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.previous_meter")))}},{slot:"current_meter",width:100,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.current_meter")))}},{slot:"amount",align:"center",width:120,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.unit_used")))}},{slot:"price_per_unit",align:"center",width:120,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.price_per_unit")))}},{slot:"total_price",align:"center",width:100,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.amount")))}}],maintenanceColumns:[{key:"asset_number",width:100,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.room_no")))}},{key:"address_number",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.address_number")))}},{key:"asset_type",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.unit_type")))}},{slot:"payment_type",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.payment_type")))}},{slot:"area_for_maintenance_fee_calculation",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.area_for_maintenance_fee_calculation")))}},{slot:"price_per_unit",align:"center",width:140,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.price_per_sqm")))}},{key:"billing_cycle_month",align:"center",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.month")))}},{slot:"total_price",align:"center",width:140,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.maintenance.label.amount")))}}],otherBillingColumns:[{slot:"other_asset_number",width:150,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.room_no")))}},{slot:"other_address_number",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.address")))}},{slot:"other_asset_type",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.unit_type")))}},{slot:"other_floor",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.floor")))}},{slot:"other_name",width:150,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.billing_name")))}},{slot:"other_from_datetime",width:200,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.from")))}},{slot:"other_to_datetime",width:200,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.to")))}},{slot:"other_price_per_unit",align:"center",width:100,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.price_per_unit")))}},{slot:"other_amount",align:"center",width:160,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.unit_used")))}},{slot:"other_total_price",align:"center",width:100,sortable:!0,renderHeader:function(t,n){return t("span","".concat(e.$t("info.billing.label.amount")))}}]}},watch:{items:function(e,t){(e&&e.length>0||!Object(o.isEqual)(e,t))&&this.reformatData(e)},billingTypeKey:function(){this.renderColumns()}},mounted:function(){this.renderColumns(),this.items&&(this.reformatData(this.items),this.fetchUnits())},methods:{convertPrice:l.c,validateNumber:l.p,checkProcessValidation:function(e){if(this.formData.billings[e].previous_meter<=this.formData.billings[e].current_meter)if(this.$refs.form.fields[5*e].validateState="",0===e)this.$refs.form.fields[1].validateState="";else{var t=5*e;this.$refs.form.fields[t+1].validateState=""}},renderColumns:function(){var e=[];switch(this.billingTypeKey){case"water_billing":"condominium"!==this.projectType&&(this.billingColumns.splice(0,1),this.billingColumns.splice(1,1)),e=this.billingColumns;break;case"maintenance_fee":e=this.maintenanceColumns;break;case"other_billing":e=this.otherBillingColumns;break;default:e=this.billingColumns}this.columns=e},calculateUnitUsageAndAmount:function(e,t){if("unit_used"===t&&"water_billing"===this.billingTypeKey){var n=this.formData.billings[e].previous_meter,r=this.formData.billings[e].current_meter;n>=0&&r>=0&&""!==n&&""!==r&&(r>n||r===n)?(this.formData.billings[e].amount=Object(l.m)(r-n),this.calculateUnitUsageAndAmount(e,"total_price")):(this.formData.billings[e].amount=null,this.formData.billings[e].total_price=null)}else{var c=this.formData.billings[e].amount,m=this.formData.billings[e].price_per_unit,f=this.formData.billings[e].total_price;"actual"===this.formData.billings[e].payment_type?(f=null,""===m||Object(o.isNaN)(Number(m))||Object(o.isNil)(m)||(f=this.formData.billings[e].area_for_maintenance_fee_calculation*m*this.formData.billings[e].billing_cycle_month)):f="asset_type"===this.formData.billings[e].payment_type?m*this.formData.billings[e].billing_cycle_month:""===c||""===m||Object(o.isNaN)(Number(c))||Object(o.isNil)(c)||Object(o.isNaN)(Number(m))||Object(o.isNil)(m)?null:c*m,Object(o.isNil)(f)?this.formData.billings[e].total_price=f:this.formData.billings[e].total_price=Object(l.m)(f)}},reformatData:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.formData.billings=[],n.next=3,Object(o.map)(e,(function(b){var e=Object(l.b)(b.price_per_unit),n=Object(l.b)(b.amount),r=b.total_price;return"actual"===b.payment_type?(r="-",e&&(r=b.area_for_maintenance_fee_calculation*e*b.billing_cycle_month)):"asset_type"===b.payment_type?r=e*b.billing_cycle_month:"other_billing"===t.billingTypeKey&&(r=n*e),r&&"-"!==r&&(r=Object(l.b)(r)),{id:b.id,payment_type:b.payment_type||"",usable_area:b.usable_area||"",asset_id:b.asset_id||"",previous_meter:Object(o.isNaN)(Number(b.previous_meter))?"":b.previous_meter,current_meter:Object(o.isNaN)(Number(b.current_meter))?"":b.current_meter,name:b.name||"",from_datetime:b.from_datetime,to_datetime:b.to_datetime,address_number:b.address_number||"",asset_type:b.asset_type||"",floor:b.floor||"",amount:n,total_price:Object(o.isNaN)(Number(r))?"":r,price_per_unit:e,billing_cycle_month:b.billing_cycle_month||"",area_for_maintenance_fee_calculation:b.area_for_maintenance_fee_calculation||""}}));case 3:return r=n.sent,n.next=6,Object(o.cloneDeep)(r);case 6:t.formData.billings=n.sent,t.isLoading=!1;case 8:case"end":return n.stop()}}),n)})))()},fetchUnits:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.a.index(e.$route.params.projectId);case 2:n=t.sent,e.units=Object(o.map)(n.units,(function(u){return u.json}));case 4:case"end":return t.stop()}}),t)})))()},checkBillingType:function(){return"water_billing"===this.billingTypeKey?this.$t("messages.update_water_billing"):"maintenance_fee"===this.billingTypeKey?this.$t("messages.update_maintenance_fee_billing"):this.$t("messages.update_other_billing")},handleSelectedUnit:function(data,e){var t=Object(o.find)(this.units,(function(e){return e.id===data.value}));this.formData.billings[e].address_number=t.address_number,this.formData.billings[e].asset_type=t.asset_type.name,this.formData.billings[e].floor=t.floor},handleSubmit:function(){var e=this;return new Promise((function(t){e.$Modal.confirm({title:e.$t("messages.confirm"),content:e.$t("messages.confirm_save"),okText:e.$t("button.yes"),cancelText:e.$t("button.no"),onOk:function(){e.submitForm()}})}))},submitForm:function(){var e=this;this.$refs.form.validate(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var r,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=7;break}return r=[],r="#modified"===e.$route.hash?"water_billing"===e.billingTypeKey?e.formData.billings:"maintenance_fee"===e.billingTypeKey?Object(o.filter)(e.formData.billings,(function(b){return b.price_per_unit})):Object(o.filter)(e.formData.billings,(function(b){return b.price_per_unit&&b.asset_id&&b.name&&b.from_datetime&&b.to_datetime&&b.amount})):"#ready"===e.$route.hash?Object(o.filter)(e.formData.billings,(function(b){return(b.previous_meter||0===b.previous_meter)&&(b.current_meter||0===b.current_meter)&&b.price_per_unit})):Object(o.filter)(e.formData.billings,(function(b){return b.previous_meter||b.current_meter||b.amount||b.total_price||b.price_per_unit||b.asset_id||b.name||b.from_datetime||b.to_datetime})),t.next=5,c.a.updateBillings(e.$route.params.projectId,e.$route.params.billingId,r);case 5:(l=t.sent).data&&l.data.success&&(e.$Message.success({content:e.checkBillingType(),duration:3}),e.$emit("closeModal"));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},d=(n(689),n(9)),component=Object(d.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.isLoading?n("GLoading"):e.formData.billings.length>0?n("Form",{ref:"form",attrs:{model:e.formData,"show-message":!1}},[n("Table",{attrs:{columns:e.columns,data:e.items,"no-data-text":e.$t("pages.no_data")},scopedSlots:e._u([{key:"payment_type",fn:function(t){var r=t.index;return["water_billing"===e.billingTypeKey?n("span",[e._v("\n          "+e._s(e.formData.billings[r].payment_type)+"\n        ")]):n("span",[e._v("\n          "+e._s(e._f("paymentType")(e.formData.billings[r].payment_type))+"\n        ")])]}},{key:"area_for_maintenance_fee_calculation",fn:function(t){var n=t.row;return[e._v("\n        "+e._s("actual"===n.payment_type?n.area_for_maintenance_fee_calculation:"-")+"\n      ")]}},{key:"previous_meter",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].previous_meter",rules:[{required:!0,trigger:"blur,change",validator:function(t,n,o){"#ready"===e.$route.hash?""===n?o("ERROR"):(Number(n)||0===Number(n))&&Number(n)<=Number(e.formData.billings[r].current_meter)?(e.checkProcessValidation(r),o()):o("ERROR"):""===n||(Number(n)||0===Number(n))&&Number(n)<=Number(e.formData.billings[r].current_meter)?(e.checkProcessValidation(r),o()):o("ERROR")}}]}},[n("Input",{attrs:{size:"small"},on:{"on-keydown":function(t){return e.validateNumber(t,!1)},"on-change":function(t){return e.calculateUnitUsageAndAmount(r,"unit_used")}},model:{value:e.formData.billings[r].previous_meter,callback:function(t){e.$set(e.formData.billings[r],"previous_meter",e._n(t))},expression:"formData.billings[index].previous_meter"}})],1)]}},{key:"current_meter",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].current_meter",rules:[{required:!0,trigger:"blur,change,submit",validator:function(t,n,o){"#ready"===e.$route.hash?""===n?o("ERROR"):(Number(n)||0===Number(n))&&Number(n)>=Number(e.formData.billings[r].previous_meter)?(e.checkProcessValidation(r),o()):o("ERROR"):""===n||(Number(n)||0===Number(n))&&Number(n)>=Number(e.formData.billings[r].previous_meter)?(e.checkProcessValidation(r),o()):o("ERROR")}}]}},[n("Input",{attrs:{size:"small"},on:{"on-keydown":function(t){return e.validateNumber(t,!1)},"on-change":function(t){return e.calculateUnitUsageAndAmount(r,"unit_used")}},model:{value:e.formData.billings[r].current_meter,callback:function(t){e.$set(e.formData.billings[r],"current_meter",e._n(t))},expression:"formData.billings[index].current_meter"}})],1)]}},{key:"price_per_unit",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].price_per_unit",rules:[{required:!0,trigger:"blur,change",validator:function(e,t,n){t?n():n("ERROR")}}]}},[n("Input",{attrs:{size:"small"},on:{"on-change":function(t){return e.calculateUnitUsageAndAmount(r,"water_billing"===e.billingTypeKey?"unit_used":"total_price")}},model:{value:e.formData.billings[r].price_per_unit,callback:function(t){e.$set(e.formData.billings[r],"price_per_unit",t)},expression:"formData.billings[index].price_per_unit"}})],1)]}},{key:"amount",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].amount"}},[n("Input",{attrs:{disabled:"",size:"small"},model:{value:e.formData.billings[r].amount,callback:function(t){e.$set(e.formData.billings[r],"amount",t)},expression:"formData.billings[index].amount"}})],1)]}},{key:"total_price",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].total_price"}},[n("Input",{attrs:{disabled:"",size:"small"},model:{value:e.formData.billings[r].total_price,callback:function(t){e.$set(e.formData.billings[r],"total_price",t)},expression:"formData.billings[index].total_price"}})],1)]}},{key:"other_price_per_unit",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].price_per_unit",rules:[{required:!0,trigger:"blur,change",validator:function(e,t,n){t?n():n("ERROR")}}]}},[n("Input",{attrs:{size:"small"},on:{"on-keydown":function(t){return e.validateNumber(t,!0)},"on-change":function(t){return e.calculateUnitUsageAndAmount(r,"total_price")}},model:{value:e.formData.billings[r].price_per_unit,callback:function(t){e.$set(e.formData.billings[r],"price_per_unit",t)},expression:"formData.billings[index].price_per_unit"}})],1)]}},{key:"other_amount",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].amount",rules:[{required:!0,trigger:"blur,change",validator:function(e,t,n){t?n():n("ERROR")}}]}},[n("Input",{attrs:{size:"small"},on:{"on-keydown":function(t){return e.validateNumber(t,!0)},"on-change":function(t){return e.calculateUnitUsageAndAmount(r,"total_price")}},model:{value:e.formData.billings[r].amount,callback:function(t){e.$set(e.formData.billings[r],"amount",t)},expression:"formData.billings[index].amount"}})],1)]}},{key:"other_total_price",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].total_price"}},[n("Input",{attrs:{disabled:"",size:"small"},model:{value:e.formData.billings[r].total_price,callback:function(t){e.$set(e.formData.billings[r],"total_price",t)},expression:"formData.billings[index].total_price"}})],1)]}},{key:"other_asset_number",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].asset_id"}},[n("Select",{attrs:{disabled:"",transfer:"",size:"small"},on:{"on-select":function(data){return e.handleSelectedUnit(data,r)}},model:{value:e.formData.billings[r].asset_id,callback:function(t){e.$set(e.formData.billings[r],"asset_id",t)},expression:"formData.billings[index].asset_id"}},e._l(e.units,(function(t){return n("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.asset_number))])})),1)],1)]}},{key:"other_address_number",fn:function(t){var r=t.index;return[n("FormItem",[n("Input",{attrs:{disabled:"",size:"small"},model:{value:e.formData.billings[r].address_number,callback:function(t){e.$set(e.formData.billings[r],"address_number",t)},expression:"formData.billings[index].address_number"}})],1)]}},{key:"other_asset_type",fn:function(t){var r=t.index;return[n("FormItem",[n("Input",{attrs:{disabled:"",size:"small"},model:{value:e.formData.billings[r].asset_type,callback:function(t){e.$set(e.formData.billings[r],"asset_type",t)},expression:"formData.billings[index].asset_type"}})],1)]}},{key:"other_floor",fn:function(t){var r=t.index;return[n("FormItem",[n("Input",{attrs:{disabled:"",size:"small"},model:{value:e.formData.billings[r].floor,callback:function(t){e.$set(e.formData.billings[r],"floor",t)},expression:"formData.billings[index].floor"}})],1)]}},{key:"other_name",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].name"}},[n("Input",{attrs:{size:"small"},model:{value:e.formData.billings[r].name,callback:function(t){e.$set(e.formData.billings[r],"name",t)},expression:"formData.billings[index].name"}})],1)]}},{key:"other_from_datetime",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].from_datetime"}},[n("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",format:"dd/MM/yyyy",transfer:"",size:"small"},model:{value:e.formData.billings[r].from_datetime,callback:function(t){e.$set(e.formData.billings[r],"from_datetime",t)},expression:"formData.billings[index].from_datetime"}})],1)]}},{key:"other_to_datetime",fn:function(t){var r=t.index;return[n("FormItem",{attrs:{prop:"billings["+r+"].to_datetime"}},[n("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",format:"dd/MM/yyyy",transfer:"",size:"small"},model:{value:e.formData.billings[r].to_datetime,callback:function(t){e.$set(e.formData.billings[r],"to_datetime",t)},expression:"formData.billings[index].to_datetime"}})],1)]}}])}),e._v(" "),n("FormItem",{attrs:{align:"center"}},[n("Button",{staticClass:"default-button button-grey",on:{click:function(t){return e.$emit("closeModal")}}},[e._v("\n        "+e._s(e.$t("button.cancel"))+"\n      ")]),e._v(" "),n("Button",{staticClass:"default-button button-green",on:{click:function(t){return e.handleSubmit()}}},[e._v("\n        "+e._s(e.$t("button.save"))+"\n      ")])],1)],1):e._e()],1)}),[],!1,null,"03876564",null);t.default=component.exports}}]);