(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{414:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(4),o=n(30),c=n(31),d=(n(25),n(3)),f=n(6),m=n(5),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,e),this.json=t,this.json.name_translations=t.name_translations||{en:"",th:""}}var t,n,h,j,l;return Object(c.a)(e,[{key:"save",value:(l=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,o=Object(m.e)(this.json,"incidentTypes"),o=Object(m.n)(o,"incident_type"),!n){e.next=10;break}return e.next=6,Object(f.d)("patch",Object(f.e)(f.a,"projects/".concat(t,"/incident_types/").concat(n)),{data:o,headers:Object(f.c)(!0)});case 6:return r=e.sent,e.abrupt("return",r);case 10:return e.next=12,Object(f.d)("post",Object(f.e)(f.a,"projects/".concat(t,"/incident_types")),{data:o,headers:Object(f.c)(!0)});case 12:return r=e.sent,e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"activate",value:(j=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("patch",Object(f.e)(f.a,"projects/".concat(t,"/incident_types/").concat(n,"/activate")),{headers:Object(f.c)(!0)});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return j.apply(this,arguments)})},{key:"inactivate",value:(h=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("patch",Object(f.e)(f.a,"projects/".concat(t,"/incident_types/").concat(n,"/inactivate")),{headers:Object(f.c)(!0)});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return h.apply(this,arguments)})},{key:"asTableJson",value:function(){return{no:this.json.no,created_at:this.json.created_at,id:this.json.id,key:this.json.key,name_translations:this.json.name_translations,sorting_index:this.json.sorting_index?parseFloat(this.json.sorting_index).toFixed(1):"-",status:this.json.status}}}],[{key:"index",value:(n=Object(r.a)(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.d)("get",Object(f.e)(f.a,"projects/".concat(n,"/incident_types")),{headers:Object(f.c)(!0)});case 2:if(200!==(r=t.sent).status){t.next=5;break}return t.abrupt("return",Object(d.map)(r.data.incident_types,(function(t){return new e(t)})));case 5:return t.abrupt("return",[]);case 6:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Object(r.a)(regeneratorRuntime.mark((function t(n,r){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.d)("get",Object(f.e)(f.a,"projects/".concat(n,"/incident_types/").concat(r)),{headers:Object(f.c)(!0)});case 2:if(200!==(o=t.sent).status){t.next=5;break}return t.abrupt("return",new e(o.data.incident_type));case 5:return t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})}]),e}()},447:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));n(21),n(15),n(18),n(32),n(33);var r=n(4),o=n(7),c=n(30),d=n(31),f=(n(25),n(3)),m=n(6);function h(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function j(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,e),this.json=j(j({},t),{},{sorting_index:"",is_required:t.is_required,question_text_translations:t.question_text_translations||{en:"",th:""},question_type:"text",choices:t.choices||[{choice_text_translations:{en:"",th:""}}]})}var t,n,o,h;return Object(d.a)(e,[{key:"activate",value:(h=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(t,"/incident_types/").concat(n,"/questions/").concat(r,"/activate")),{headers:Object(m.c)(!0)});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return h.apply(this,arguments)})},{key:"inactivate",value:(o=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(t,"/incident_types/").concat(n,"/questions/").concat(r,"/inactivate")),{headers:Object(m.c)(!0)});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return o.apply(this,arguments)})}],[{key:"save",value:function(e,t,n,r){var o=Object(f.cloneDeep)(e),c=Object(f.map)(o,(function(e){return e.choices.length<1&&delete e.choices,Object(f.map)(e.choices,(function(e){e.choice_id=e.id,delete e.id})),e.question_id=e.id,e.is_required="Yes"===e.is_required,delete e.id,e}));return r?Object(m.d)("post",Object(m.e)(m.a,"projects/".concat(t,"/incident_types/").concat(n,"/questions")),{data:{questions:c},headers:Object(m.c)(!0)}):Object(m.d)("patch",Object(m.e)(m.a,"projects/".concat(t,"/incident_types/").concat(n,"/questions/update_questions/")),{data:{questions:c},headers:Object(m.c)(!0)})}},{key:"removeQuestion",value:(n=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("delete",Object(m.e)(m.a,"projects/".concat(t,"/incident_types/").concat(n,"/questions/").concat(r)),{headers:Object(m.c)(!0)});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"removeChoice",value:(t=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r,o){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.d)("delete",Object(m.e)(m.a,"projects/".concat(t,"/incident_types/").concat(n,"/questions/").concat(r,"/choices/").concat(o)),{headers:Object(m.c)(!0)});case 2:return c=e.sent,e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)}))),function(e,n,r,o){return t.apply(this,arguments)})}]),e}()},770:function(e,t,n){"use strict";n.r(t);n(21),n(15),n(18),n(32),n(33);var r=n(7),o=n(4),c=(n(11),n(54),n(25),n(3)),d=n(414),f=n(447);function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}var h={data:function(){return{formData:{questions:[]},isLoading:!0}},computed:{language:function(){return this.$store.state.language.value}},mounted:function(){this.fetchQuestion()},methods:{fetchQuestion:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,d.a.show(e.$route.params.projectId,e.$route.params.incidentTypeId);case 3:n=t.sent,Object(c.map)(n.json.questions,(function(e){!0===e.is_required?e.is_required="Yes":e.is_required="No"})),e.formData=n.json,e.formData.questions=n.json.questions,e.isLoading=!1;case 8:case"end":return t.stop()}}),t)})))()},addFormQuestion:function(){if(this.formData.questions.length>0){var e=new f.a;this.formData.questions.push(e.json)}},updateQuestionForm:function(data){Object(c.isEmpty)(this.formData.questions)&&this.formData.questions.push(function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},data))},removeQuestionForms:function(e){var t=this;if(this.formData.questions[e].id)return new Promise((function(n){var r;t.$Modal.confirm({title:t.$t("messages.are_you_sure"),content:t.$t("messages.confirm_delete"),okText:t.$t("button.yes"),cancelText:t.$t("button.no"),onOk:(r=Object(o.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,f.a.removeQuestion(t.$route.params.projectId,t.$route.params.incidentTypeId,t.formData.questions[e].id);case 2:(r=n.sent).data&&r.data.success?(t.$Message.success({content:t.$t("pages.question")+t.$t("messages.successfully_remove"),duration:3}),t.formData.questions.splice(e,1)):t.$Message.error({content:t.$t("messages.fail"),duration:8});case 4:case"end":return n.stop()}}),n)}))),function(){return r.apply(this,arguments)})})}));this.formData.questions.splice(e,1)},removeChoices:function(e,i){var t=this;if(this.formData.questions[e].choices[i].id){if(0!==i||1!==this.formData.questions[e].choices.length)return new Promise((function(n){var r;t.$Modal.confirm({title:t.$t("messages.are_you_sure"),content:t.$t("messages.confirm_delete"),okText:t.$t("button.yes"),cancelText:t.$t("button.no"),onOk:(r=Object(o.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,f.a.removeChoice(t.$route.params.projectId,t.$route.params.incidentTypeId,t.formData.questions[e].id,t.formData.questions[e].choices[i].id);case 2:(r=n.sent).data&&r.data.success?(t.$Message.success({content:t.$t("pages.choice")+t.$t("messages.successfully_remove"),duration:3}),t.formData.questions[e].choices.splice(i,1)):t.$Message.error({content:t.$t("messages.fail"),duration:8});case 4:case"end":return n.stop()}}),n)}))),function(){return r.apply(this,arguments)})})}));this.formData.questions[e].choices[i].choice_text_translations=[]}else 1!==this.formData.questions[e].choices.length&&this.formData.questions[e].choices.splice(i,1)},handleSubmit:function(){var e=this;return new Promise((function(t){e.$Modal.confirm({title:e.$t("messages.are_you_sure"),content:e.$t("messages.confirm_save"),okText:e.$t("button.yes"),cancelText:e.$t("button.no"),onOk:function(){e.submitForm()}})}))},submitForm:function(){var e=this;this.$refs.form.validate(function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(n){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=7;break}return t.next=3,f.a.save(e.formData.questions,e.$route.params.projectId,e.$route.params.incidentTypeId);case 3:(r=t.sent).data&&r.data.success?(e.$Message.success({content:e.$t("pages.question")+e.$t("messages.successfully_updated"),duration:3}),e.$router.push({name:"projects-projectId-incident_types-incidentTypeId-show",params:{projectId:e.$route.params.projectId}})):r.data.error?(o=r.data.error.replace(":",""),o=Object(c.snakeCase)(o),e.$Message.error({content:e.$t("messages."+o),duration:8})):e.$Message.error({content:e.$t("messages.fail"),duration:8}),t.next=8;break;case 7:e.$Message.error({content:e.$t("messages.fail"),duration:8});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},j=n(9),component=Object(j.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isLoading?n("GLoading"):n("div",[n("GBreadCrumb",{attrs:{"is-not-show":"","index-not-show":2,names:[e.formData.name_translations]}}),e._v(" "),n("Card",{attrs:{"dis-hover":"",bordered:!1}},[n("p",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("button.edit"))+e._s(e.$t("pages.question")))]),e._v(" "),n("Form",{ref:"form",attrs:{model:e.formData}},e._l(e.formData.questions,(function(t,r){return n("GQuestionForm",{key:r,attrs:{question:t,"question-index":r},on:{updateQuestionForm:function(data){return e.updateQuestionForm(data)},removeQuestionForms:e.removeQuestionForms,removeChoices:e.removeChoices}})})),1),e._v(" "),n("Row",{staticClass:"pt-8",attrs:{type:"flex",justify:"center"}},[n("Col",[n("Button",{attrs:{icon:"md-add",type:"primary",shape:"circle"},nativeOn:{click:function(t){return e.addFormQuestion(t)}}})],1)],1),e._v(" "),n("Row",{staticClass:"pt-8",attrs:{type:"flex",justify:"center"}},[n("Col",[n("Button",{staticClass:"default-button button-grey",attrs:{to:{name:"projects-projectId-incident_types-incidentTypeId-show",params:{projectId:e.$route.params.projectId,incidentTypeId:e.$route.params.incidentTypeId}}}},[e._v("\n          "+e._s(e.$t("button.cancel"))+"\n        ")]),e._v(" "),n("Button",{staticClass:"default-button button-green",on:{click:function(t){return e.handleSubmit()}}},[e._v("\n          "+e._s(e.$t("button.save"))+"\n        ")])],1)],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports}}]);